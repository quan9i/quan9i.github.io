{"title":"docker搭建的wordpress博客http转换https","uid":"d6ca6f4d3d89a2aaf340b7664d7ca172","slug":"docker搭建的博客HTTP转HTTPS","date":"2022-05-18T03:56:30.000Z","updated":"2023-03-14T07:27:18.000Z","comments":true,"path":"api/articles/docker搭建的博客HTTP转HTTPS.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141527785.png","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>由于http显示的不安全让我感觉很不好，所以百度了一下，添加了SSL证书，而后成功转换成了https，过程记录如下，希望对师傅们有所帮助。</p>\n<h1 id=\"端口\"><a href=\"#端口\" class=\"headerlink\" title=\"端口\"></a>端口</h1><p>第一个我们需要注意的事情就是我们是否开启了443端口，我们的服务器是否开了端口</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154306.png\" alt=\"在这里插入图片描述\"></p>\n<p>而后呢，我们需要查看我们的wordpress是否开启了443映射端口，可以用以下命令来查看</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">docker ps<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154330.png\" alt=\"在这里插入图片描述\"></p>\n<p>可以看见我这个之前并未设置443端口，443端口对应的是https服务，因此我们首先需要打开这个https服务，修改映射端口有两种方法，一种是复制镜像，然后再开一次，但是这种的话我们是连接了mysql数据库的，那它就重置了，就需要重新设置</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154313.png\" alt=\"在这里插入图片描述\"></p>\n<p>因此我们这里选择另一个方法，就是直接修改代码来添加映射端口，步骤如下</p>\n<p>首先找一下容器对应的id</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">docker inspect <span class=\"token class-name\">wordpress</span><span class=\"token operator\">|</span><span class=\"token class-name\">grep</span> Id\n   <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154339.png\" alt=\"在这里插入图片描述\"></p>\n<p>然后此时我们切换到<code>/var/lib/docker/containers</code>路径下，镜像在这个文件夹下</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154360.png\" alt=\"在这里插入图片描述\"></p>\n<p>此时我们还需要关闭一下我们的docker容器并关闭docker</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">docker stop <span class=\"token number\">3</span>f6c5d4929570921d7ea3f3df0b965148ff17355db465a140fd18a6b3e59bb7b\n<span class=\"token comment\">//关闭wordpress容器</span>\ndocker stop  <span class=\"token number\">66308</span>fc65ccf\n<span class=\"token comment\">//关闭mysql容器</span>\nsystemctl stop docker<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>然后进入我们对应容器的文件夹下,编辑hostconfig.json文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">cd <span class=\"token number\">3</span>f6c5d4929570921d7ea3f3df0b965148ff17355db465a140fd18a6b3e59bb7b\nvim  hostconfig<span class=\"token operator\">.</span>json<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154352.png\" alt=\"在这里插入图片描述\"></p>\n<p>进入后在PortBandings后加上<code>&quot;443/tcp&quot;: [&#123;&quot;HostIp&quot;: &quot;&quot;,&quot;HostPort&quot;: &quot;443&quot;&#125;]</code></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154074.png\" alt=\"在这里插入图片描述\"></p>\n<p>然后保存并退出</p>\n<p>再编辑config.v2.json文件</p>\n<p>进入后在ExposedPorts中加上<code>&quot;443/tcp&quot;:&#123;&#125;</code></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154037.png\" alt=\"在这里插入图片描述\"></p>\n<p>保存并退出</p>\n<p>然后再打开docker并开启容器即可</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">systemctl start docker\ndocker start 容器id<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>此时再docker ps，就可以看见映射端口有443了</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154992.png\" alt=\"在这里插入图片描述\"></p>\n<p>设置端口的工作就完成了</p>\n<h1 id=\"申请并上传SSL证书\"><a href=\"#申请并上传SSL证书\" class=\"headerlink\" title=\"申请并上传SSL证书\"></a>申请并上传SSL证书</h1><p>我用的服务器是腾讯云的，然后在服务器里添加上自己的域名后，搜索SSL证书就会出现申请免费证书的，我们申请一下，一般几分钟就好了</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154890.png\" alt=\"在这里插入图片描述\"></p>\n<p>而后下载证书，将zip文件解压，将里面的key和pem后缀的上传到服务器，就是下图的后面两个文件</p>\n<p><img src=\"https://img-blog.csdnimg.cn/8dfa54fd950b4ef2bb0e3b0c0f288549.png\" alt=\"在这里插入图片描述\"></p>\n<p>先上传到服务器上，我用的是finalshell，其他应该都差不多，直接拖文件到里面就可以</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154013.png\" alt=\"在这里插入图片描述\"></p>\n<p>此时有一个问题，就是如何将文件上传到docker容器里，经过百度后发现命令如下</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docker cp 服务器路径 容器id:容器路径<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>那我这里的话就是</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docker cp &#x2F;tmp&#x2F;www.quan9i.top.key  3f6c5d492957:&#x2F;etc&#x2F;ssl<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>另一个同理</p>\n<h1 id=\"加载模块及修改文件\"><a href=\"#加载模块及修改文件\" class=\"headerlink\" title=\"加载模块及修改文件\"></a>加载模块及修改文件</h1><p>此时准备工作完成，我们进入wordpress容器</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docekr exec -it 容器id &#x2F;bin&#x2F;bash<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>首先我们需要加载一下openssl模块，输入如下指令</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">openssl\n&#x2F;&#x2F;此时如果如下图，说明已经安装过了，输入exit退出即可<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154407.png\" alt=\"在这里插入图片描述\"></p>\n<p>此时需要再加载 apache SSL 模块，指令如下</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">a2enmod ssl\n&#x2F;&#x2F;第一次的话会要求重启Apache服务，此时我们退出容器重启一下即可<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154575.png\" alt=\"在这里插入图片描述\"></p>\n<p>Apache 加载 SSL 模块后，会在 <code>/etc/apache2/sites-available</code> 下生成 <code>default-ssl.conf</code> 文件，因此我们此时就去编辑这个文件</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">vim  &#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;default-ssl.conf\nSSLCertificateFile\t&#x2F;etc&#x2F;ssl&#x2F;www.quan9i.top.pem\n&#x2F;&#x2F;这个路径是自己设置的，我们前面服务器上传文件上传到了容器的这个文件夹下\nSSLCertificateKeyFile &#x2F;etc&#x2F;ssl&#x2F;www.quan9i.top.key<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154593.png\" alt=\"在这里插入图片描述\"></p>\n<p>此时修改完成，保存退出即可</p>\n<p>此时还需要让ssl被apache加载，指令如下</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">ln -s &#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;default-ssl.conf &#x2F;etc&#x2F;apache2&#x2F;sites-enabled&#x2F;default-ssl.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>此时还需要设置一下强制http转https，指令如下</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">vim &#x2F;etc&#x2F;apache2&#x2F;sites-available&#x2F;000-default.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>在<code>&lt;VirtualHost *:80&gt; &lt;/VirtualHost&gt;</code>标签下添加如下内容</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;Directory &quot;&#x2F;var&#x2F;www&#x2F;html&quot;&gt; \n    RewriteEngine   on\n    RewriteBase &#x2F;\n    # FORCE HTTPS\n    RewriteCond %&#123;HTTPS&#125; !&#x3D;on\n    RewriteRule ^&#x2F;?(.*) https:&#x2F;&#x2F;%&#123;SERVER_NAME&#125;&#x2F;$1 [R,L]\n&lt;&#x2F;Directory&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154730.png\" alt=\"在这里插入图片描述\"></p>\n<p>此时就可以实现强制http转https，退出容器，重启一下wordpress即可</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docker restart wordpress<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154006.png\" alt=\"在这里插入图片描述\"></p>\n<p>发现可以了，但是我们还需要做最后一步，就是修改wordpress里的url地址，在设置的常规里修改一下即可</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130154112.png\" alt=\"在这里插入图片描述\"></p>\n<p>此时就实现了http转https</p>\n<h1 id=\"尾记\"><a href=\"#尾记\" class=\"headerlink\" title=\"尾记\"></a>尾记</h1><p>博主只是小白，可能在某方面会出现部分问题，还请各位师傅多多指教。</p>\n<h1 id=\"参考文章\"><a href=\"#参考文章\" class=\"headerlink\" title=\"参考文章\"></a>参考文章</h1><p><a href=\"https://blog.csdn.net/wkh___/article/details/114879500\">https://blog.csdn.net/wkh___/article/details/114879500</a></p>\n<p><a href=\"https://www.jianshu.com/p/e8ae8bb1ad0a\">https://www.jianshu.com/p/e8ae8bb1ad0a</a></p>\n<p><a href=\"https://blog.csdn.net/u012577474/article/details/109702141\">https://blog.csdn.net/u012577474/article/details/109702141</a></p>\n","feature":false,"text":"前言由于http显示的不安全让我感觉很不好，所以百度了一下，添加了SSL证书，而后成功转换成了https，过程记录如下，希望对师傅们有所帮助。 端口第一个我们需要注意的事情就是我们是否开启了443端口，我们的服务器是否开了端口 而后呢，我们需要查看我们的wordpress是否开启...","link":"","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[{"name":"博客","slug":"博客","count":2,"path":"api/categories/博客.json"}],"tags":[{"name":"博客搭建","slug":"博客搭建","count":2,"path":"api/tags/博客搭建.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AB%AF%E5%8F%A3\"><span class=\"toc-text\">端口</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%94%B3%E8%AF%B7%E5%B9%B6%E4%B8%8A%E4%BC%A0SSL%E8%AF%81%E4%B9%A6\"><span class=\"toc-text\">申请并上传SSL证书</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97%E5%8F%8A%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">加载模块及修改文件</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%B0%BE%E8%AE%B0\"><span class=\"toc-text\">尾记</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0\"><span class=\"toc-text\">参考文章</span></a></li></ol>","author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"记一次较为详细的某CMS代码审计","uid":"2630421829e46cd019f16a83899a54d6","slug":"记一次较为详细的某CMS代码审计","date":"2022-06-08T09:35:30.000Z","updated":"2024-02-14T07:32:40.000Z","comments":true,"path":"api/articles/记一次较为详细的某CMS代码审计.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141523815.png","text":"声明文章首发于先知社区https://xz.aliyun.com/t/11714 前言本次审计的话是Seay+昆仑镜进行漏洞扫描Seay的话它可以很方便的查看各个文件，而昆仑镜可以很快且扫出更多的漏洞点，将这两者进行结合起来，就可以发挥更好的效果。昆仑镜官方地址https://g...","link":"","photos":[],"count_time":{"symbolsCount":"32k","symbolsTime":"29 mins."},"categories":[{"name":"代码审计","slug":"代码审计","count":7,"path":"api/categories/代码审计.json"}],"tags":[{"name":"代码审计","slug":"代码审计","count":6,"path":"api/tags/代码审计.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"服务器+docker搭建wordpress博客","uid":"a45f7c773a3149d4d0d45e9d198b7bbc","slug":"服务器+docker搭建wordpress博客","date":"2022-05-18T03:56:30.000Z","updated":"2023-03-14T07:19:26.000Z","comments":true,"path":"api/articles/服务器+docker搭建wordpress博客.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141518266.png","text":"前言由于http显示的不安全让我感觉很不好，所以百度了一下，添加了SSL证书，而后成功转换成了https，过程记录如下，希望对师傅们有所帮助。 端口第一个我们需要注意的事情就是我们是否开启了443端口，我们的服务器是否开了端口 而后呢，我们需要查看我们的wordpress是否开启...","link":"","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[{"name":"博客","slug":"博客","count":2,"path":"api/categories/博客.json"}],"tags":[{"name":"博客搭建","slug":"博客搭建","count":2,"path":"api/tags/博客搭建.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":false}}